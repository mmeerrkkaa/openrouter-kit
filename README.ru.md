# OpenRouter Kit

[![–í–µ—Ä—Å–∏—è npm](https://badge.fury.io/js/openrouter-kit.svg)](https://badge.fury.io/js/openrouter-kit) [![–õ–∏—Ü–µ–Ω–∑–∏—è: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT) [![TypeScript](https://img.shields.io/badge/%3C/%3E-TypeScript-%230074C1.svg)](http://www.typescriptlang.org/)

**üá∑üá∫ –†—É—Å—Å–∫–∏–π** | [üá¨üáß English](./README.en.md)
---

**OpenRouter Kit** ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è, –≥–∏–±–∫–∞—è –∏ —É–¥–æ–±–Ω–∞—è TypeScript/JavaScript –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å [OpenRouter API](https://openrouter.ai/). –û–Ω–∞ —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å LLM, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API –¥–ª—è —á–∞—Ç–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π, –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (function calling), –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤, –≤–µ–±-–ø–æ–∏—Å–∫, —Ç–æ–∫–µ–Ω—ã —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install openrouter-kit
# –∏–ª–∏
yarn add openrouter-kit
# –∏–ª–∏
pnpm add openrouter-kit
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É:

### 1. –ü—Ä–æ—Å—Ç–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞

–°–∞–º—ã–π –±–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç –º–æ–¥–µ–ª–∏.

–ò –Ω–µ –∑–∞–±—ã–≤–∞–µ–º –ø—Ä–æ –¥–æ–±—Ä—ã–π –ø—Ä–æ–∫—Å–∏

```typescript
// simple-chat.ts
import { OpenRouterClient } from 'openrouter-kit';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º
const client = new OpenRouterClient({
  apiKey: process.env.OPENROUTER_API_KEY || 'sk-or-v1-...',
  model: "google/gemini-2.0-flash-001" // –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤
});

async function main() {
  try {
    console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞...');
    const result = await client.chat({
      prompt: '–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è README.',
      model: 'openai/gpt-4o-mini', // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–¥–µ–ª—å –¥–ª—è —ç—Ç–æ–≥–æ –≤—ã–∑–æ–≤–∞
      temperature: 0.7,
    });

    console.log('--- –†–µ–∑—É–ª—å—Ç–∞—Ç ---');
    console.log('–û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏:', result.content);
    console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å:', result.model);
    console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤:', result.usage);

  } catch (error: any) {
    console.error(`\n--- –û—à–∏–±–∫–∞ ---`);
    console.error(`–°–æ–æ–±—â–µ–Ω–∏–µ: ${error.message}`);
  } finally {
    console.log('\n–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...');
    // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã (—Ç–∞–π–º–µ—Ä—ã –∏ —Ç.–¥.)
    await client.destroy();
  }
}

main();
```

```javascript
// .js.
const { OpenRouterClient, MemoryHistoryStorage } = require("openrouter-kit");

const client = new OpenRouterClient({
  apiKey: "sk-or-v1-",
  historyAdapter: new MemoryHistoryStorage(),
  model: "google/gemini-2.0-flash-exp:free",
//  proxy: proxyConfig, // For people from countries where models are prohibited (for example, Russia), a proxy is required.
  debug: false
});

const systemPrompt = `You are a helpful assistant.`;

async function dasd(nick, message) {
  console.log(`[${nick}]: ${message}`);

    const result = await client.chat({
      systemPrompt: systemPrompt,
      prompt: message,
      user: nick,
      temperature: 0.7
    });
    
    console.log(`[bot]: ${result.content}`);
    return result.content;
}

async function main() {
    const result1 = await dasd("merka", "my name is merka");
    const result2 = await dasd("merkava", "what is my name?");
    const result3 = await dasd("merka", "what is my name?");
    

    console.log("result1:", result1);
    console.log("result2:", result2);
    console.log("result3:", result3);
    
}

main(); 
```

### 2. –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞ (—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–µ–π)

–ß—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `historyAdapter` –∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `user` ID. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é.

```typescript
// dialog-chat.ts
import { OpenRouterClient, MemoryHistoryStorage } from 'openrouter-kit';

const client = new OpenRouterClient({
  apiKey: process.env.OPENROUTER_API_KEY || 'sk-or-v1-...',
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º MemoryHistoryStorage –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤ –ø–∞–º—è—Ç–∏
  historyAdapter: new MemoryHistoryStorage(),
  enableCostTracking: true, // –í–∫–ª—é—á–∞–µ–º —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  model: "google/gemini-2.0-flash-001"
});

const userId = 'dialog-user-123'; // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

async function runDialog() {
  try {
    // –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    console.log(`[${userId}] –í—ã: –ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?`);
    const result1 = await client.chat({
      user: userId, // <-- –ü–µ—Ä–µ–¥–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π
      prompt: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?',
    });
    console.log(`[${userId}] –ë–æ—Ç: ${result1.content}`);
    console.log(`(–°—Ç–æ–∏–º–æ—Å—Ç—å: $${result1.cost?.toFixed(6) || 'N/A'})`);

    // –í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –ø–æ–º–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç)
    console.log(`\n[${userId}] –í—ã: –ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è?`);
    const result2 = await client.chat({
      user: userId, // <-- –¢–æ—Ç –∂–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      prompt: '–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è?',
    });
    console.log(`[${userId}] –ë–æ—Ç: ${result2.content}`);
    console.log(`(–°—Ç–æ–∏–º–æ—Å—Ç—å: $${result2.cost?.toFixed(6) || 'N/A'})`);

    // –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
    const historyManager = client.getHistoryManager();
    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ _getHistoryKey
    const historyKey = `user:${userId.replace(/[:/\\?#%]/g, '_')}`;
    const history = await historyManager.getHistory(historyKey);
    console.log(`\n–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è ${historyKey}: ${history.length}`);

  } catch (error: any) {
    console.error(`\n--- –û—à–∏–±–∫–∞ ---`);
    console.error(`–°–æ–æ–±—â–µ–Ω–∏–µ: ${error.message}`);
    if (error.code) console.error(`–ö–æ–¥ –æ—à–∏–±–∫–∏: ${error.code}`);
  } finally {
    console.log('\n–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –¥–∏–∞–ª–æ–≥–∞...');
    await client.destroy();
  }
}

runDialog();
```

### 3. –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Tools / Function Calling)

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–∏ (–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

```javascript
// tools-example.js (CommonJS)
const { OpenRouterClient } = require("openrouter-kit");

// --- –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏) ---
const users = [ { id: "user_1001", nick: "alice" }, /* ... */ ];
const messages = [ { id: "msg_101", userId: "user_1001", content: "–ü—Ä–∏–≤–µ—Ç!" }, /* ... */ ];
// ---

// --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ---
const userTools = [
  {
    type: "function",
    function: {
      name: "getUserIdByNick",
      description: "–ü–æ–ª—É—á–∞–µ—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ –Ω–∏–∫–Ω–µ–π–º—É",
      parameters: { /* ... —Å—Ö–µ–º–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ... */ },
    },
    execute: async (args) => {
      console.log(`[Tool Execute: getUserIdByNick] Args: ${JSON.stringify(args)}`);
      const user = users.find(u => u.nick.toLowerCase() === args.nick.toLowerCase());
      return user ? { userId: user.id, found: true } : { userId: null, found: false };
    }
  },
  {
    type: "function",
    function: {
      name: "getUserMessages",
      description: "–ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ ID",
      parameters: { /* ... —Å—Ö–µ–º–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ... */ },
    },
    execute: async (args) => {
      console.log(`[Tool Execute: getUserMessages] Args: ${JSON.stringify(args)}`);
      const userMessages = messages.filter(m => m.userId === args.userId);
      return { messages: userMessages, count: userMessages.length, found: userMessages.length > 0 };
    }
  }
];
// ---

const client = new OpenRouterClient({
  apiKey: process.env.OPENROUTER_API_KEY || "sk-or-v1-...",
  model: "google/gemini-2.0-flash-001", // –ú–æ–¥–µ–ª—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
});

async function main() {
  try {
    const promptAlice = "–ù–∞–π–¥–∏ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è alice.";
    console.log(`\n–ó–∞–ø—Ä–æ—Å: "${promptAlice}"`);
    const resultAlice = await client.chat({
      prompt: promptAlice,
      tools: userTools,
      temperature: 0.5, 
    });
    console.log(`–û—Ç–≤–µ—Ç:\n${resultAlice.content}`);
    console.log(`(–í—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: ${resultAlice.toolCallsCount})`);

    const promptNonExistent = "–ß—Ç–æ –ø–∏—Å–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å nonexistent_user?";
    console.log(`\n–ó–∞–ø—Ä–æ—Å: "${promptNonExistent}"`);
    const resultNonExistent = await client.chat({
      prompt: promptNonExistent,
      tools: userTools,
      temperature: 0.1,
    });
    console.log(`–û—Ç–≤–µ—Ç:\n${resultNonExistent.content}`);
    console.log(`(–í—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: ${resultNonExistent.toolCallsCount})`);

  } catch (error) {
    console.error("\n--- –û—à–∏–±–∫–∞ ---");
    console.error(error);
  } finally {
    await client.destroy();
  }
}

main();
```

---

## üìö –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –≤—ã —É–≤–∏–¥–µ–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã, –≤—ã –º–æ–∂–µ—Ç–µ —É–≥–ª—É–±–∏—Ç—å—Å—è –≤ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

### –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

*   [üåü –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenRouter Kit?](#-–∑–∞—á–µ–º-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å-openrouter-kit)
*   [üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–∫–ª—é—á–µ–≤—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
*   [üöï –ü—Ä–∏–º–µ—Ä: –¢–∞–∫—Å–∏-–±–æ—Ç](#-–ø—Ä–∏–º–µ—Ä-—Ç–∞–∫—Å–∏-–±–æ—Ç)
*   [‚öôÔ∏è API –∏ –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏](#Ô∏è-api-–∏-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
    *   [OpenRouterClient](#openrouterclient)
        *   [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (OpenRouterConfig)](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-openrouterconfig)
        *   [–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–º–µ—Ç–æ–¥—ã)
        *   [–û–ø—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ `client.chat` (OpenRouterRequestOptions)](#-–æ–ø—Ü–∏–∏-–∑–∞–ø—Ä–æ—Å–∞-clientchat-openrouterrequestoptions)
        *   [–†–µ–∑—É–ª—å—Ç–∞—Ç `client.chat` (ChatCompletionResult)](#-—Ä–µ–∑—É–ª—å—Ç–∞—Ç-clientchat-chatcompletionresult)
    *   [–ü–ª–∞–≥–∏–Ω—ã –∏ Middleware](#-–ø–ª–∞–≥–∏–Ω—ã-–∏-middleware)
    *   [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π (–ê–¥–∞–ø—Ç–µ—Ä—ã)](#-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∏—Å—Ç–æ—Ä–∏–µ–π-–∞–¥–∞–ø—Ç–µ—Ä—ã)
    *   [–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Function Calling)](#-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤-function-calling)
    *   [–ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SecurityManager)](#-–º–æ–¥—É–ª—å-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏-securitymanager)
    *   [–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (Cost Tracking)](#-–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ-—Å—Ç–æ–∏–º–æ—Å—Ç–∏-cost-tracking)
    *   [–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (–ú–æ–¥–µ–ª–∏ –∏ –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã)](#-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è-–º–æ–¥–µ–ª–∏-–∏-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã)
    *   [–í–µ–±-–ø–æ–∏—Å–∫](#-–≤–µ–±-–ø–æ–∏—Å–∫)
    *   [–¢–æ–∫–µ–Ω—ã –†–∞—Å—Å—É–∂–¥–µ–Ω–∏–π (Reasoning Tokens)](#-—Ç–æ–∫–µ–Ω—ã-—Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π-reasoning-tokens)
    *   [–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (responseFormat –∏ Structured Outputs)](#Ô∏è-—Ñ–æ—Ä–º–∞—Ç-–æ—Ç–≤–µ—Ç–∞-responseformat-–∏-structured-outputs)
    *   [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#Ô∏è-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
    *   [–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
    *   [–ü—Ä–æ–∫—Å–∏](#-–ø—Ä–æ–∫—Å–∏)
*   [üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è](#-–ª–∏—Ü–µ–Ω–∑–∏—è)

### üåü –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenRouter Kit?

*   **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –°–ª–æ–∂–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–∫—Ä—ã—Ç—ã –∑–∞ –ø—Ä–æ—Å—Ç—ã–º –º–µ—Ç–æ–¥–æ–º `client.chat()`.
*   **–ì–∏–±–∫–æ—Å—Ç—å:** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –º–æ–¥–µ–ª–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, **—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç –∞–¥–∞–ø—Ç–µ—Ä)**, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤/–º–æ–¥–µ–ª–µ–π –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ –∫–∞–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ, —Ç–∞–∫ –∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–º–æ–≥–∞–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å –≤–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
*   **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–ª–∞–≥–∏–Ω—ã –∏ middleware –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –ª–æ–≥–∏–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–¥—Ä–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.
*   **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ TypeScript, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–≤–∫–ª—é—á–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤) –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏.
*   **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ–±-–ø–æ–∏—Å–∫–∞, —Ç–æ–∫–µ–Ω–æ–≤ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π OpenRouter API.

### üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **ü§ñ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —á–∞—Ç:** –ü—Ä–æ—Å—Ç–æ–π –∏ –º–æ—â–Ω—ã–π API (`client.chat`) –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ª—é–±–æ–π –º–æ–¥–µ–ª—å—é, –¥–æ—Å—Ç—É–ø–Ω–æ–π —á–µ—Ä–µ–∑ OpenRouter.
*   **üìú –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π (—á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä—ã):** **–¢—Ä–µ–±—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `historyAdapter`**. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`user`).
    *   –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ –±–∞–∑–µ **–∞–¥–∞–ø—Ç–µ—Ä–æ–≤** (`IHistoryStorage`).
    *   –í –∫–æ–º–ø–ª–µ–∫—Ç–µ: `MemoryHistoryStorage`, `DiskHistoryStorage`.
    *   –õ–µ–≥–∫–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å —Å–≤–æ–∏ –∞–¥–∞–ø—Ç–µ—Ä—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω (`createRedisHistoryPlugin`).
    *   –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TTL –∫—ç—à–∞ (`historyTtl`) –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –æ—á–∏—Å—Ç–∫–∏ (`historyCleanupInterval`).
*   **üõ†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Function Calling):** –ë–µ—Å—à–æ–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ –≤–∞—à–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –º–æ–¥–µ–ª—å—é.
    *   –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`Tool`) —Å JSON Schema –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥, –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ **–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
    *   –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–∞—à–∏—Ö `execute` —Ñ—É–Ω–∫—Ü–∏–π —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`ToolContext`).
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ –º–æ–¥–µ–ª–∏.
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –º–æ–¥–µ–ª—å—é.
    *   –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ª–∏–º–∏—Ç –Ω–∞ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã (`maxToolCalls`).
*   **üõ°Ô∏è –ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –∑–∞—â–∏—Ç–∞.
    *   **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** JWT (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è), `api-key`, `custom`.
    *   **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ (ACL):** –ü–æ —Ä–æ–ª—è–º, —Å–∫–æ—É–ø–∞–º, API-–∫–ª—é—á–∞–º, —è–≤–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º.
    *   **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã (Rate Limiting):** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Ä–æ–ª–µ–π. (–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è **–Ω–µ** –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º).
    *   **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:** –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (SQLi, XSS –∏ –¥—Ä.). –†–µ–∂–∏–º –∞—É–¥–∏—Ç–∞.
    *   **–°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
*   **üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (Cost Tracking):** (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞ `chat()`. –§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω. –ú–µ—Ç–æ–¥ `getCreditBalance()`.
*   **üîÑ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (–ú–æ–¥–µ–ª–∏ –∏ –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã):**
    *   **–ú–æ–¥–µ–ª–∏:** –£–∫–∞–∑–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (`modelFallbacks` –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∏–ª–∏ `models` –≤ –∑–∞–ø—Ä–æ—Å–µ).
    *   **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã:** –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (`provider` –≤ –∑–∞–ø—Ä–æ—Å–µ) –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ (`defaultProviderRouting` –≤ –∫–æ–Ω—Ñ–∏–≥–µ) - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (—Ü–µ–Ω–∞, —Å–∫–æ—Ä–æ—Å—Ç—å), –ø–æ—Ä—è–¥–æ–∫, –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏ –¥—Ä.
*   **üåê –í–µ–±-–ø–æ–∏—Å–∫:** (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–µ–±-–ø–æ–∏—Å–∫–∞ –≤ –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ –æ–ø—Ü–∏—é `plugins: [{ id: 'web', ... }]` –∏–ª–∏ —Å—É—Ñ—Ñ–∏–∫—Å `:online` –∫ –∏–º–µ–Ω–∏ –º–æ–¥–µ–ª–∏. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (`annotations`) —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏.
*   **ü§î –¢–æ–∫–µ–Ω—ã –†–∞—Å—Å—É–∂–¥–µ–Ω–∏–π (Reasoning Tokens):** (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–ø—Ä–æ—Å –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —à–∞–≥–æ–≤ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ –æ–ø—Ü–∏—é `reasoning`.
*   **üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –í—ã–≤–æ–¥—ã:** –ó–∞–ø—Ä–æ—Å –æ—Ç–≤–µ—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (`responseFormat: { type: 'json_object' }`) –∏–ª–∏ –ø–æ —Å—Ç—Ä–æ–≥–æ–π JSON Schema (`responseFormat: { type: 'json_schema', json_schema: {...} }`), –≤–∫–ª—é—á–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ñ–ª–∞–≥–∞ `strict`.
*   **‚öôÔ∏è –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞, –º–æ–¥–µ–ª–∏, —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, —Ç–∞–π–º–∞—É—Ç–æ–≤, **–ø—Ä–æ–∫—Å–∏**, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, **–∞–¥–∞–ø—Ç–µ—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏** –∏ –º–Ω–æ–≥–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ —á–µ—Ä–µ–∑ `OpenRouterConfig`.
*   **üí° –¢–∏–ø–∏–∑–∞—Ü–∏—è:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ TypeScript.
*   **üö¶ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –ü–æ–Ω—è—Ç–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ—à–∏–±–æ–∫ (`OpenRouterError` –∏ –ø–æ–¥–∫–ª–∞—Å—Å—ã) —Å –∫–æ–¥–∞–º–∏ (`ErrorCode`) –∏ –¥–µ—Ç–∞–ª—è–º–∏.
*   **üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ª–æ–≥–≥–µ—Ä (`Logger`) —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ –∏ —Ä–µ–∂–∏–º–æ–º –æ—Ç–ª–∞–¥–∫–∏ (`debug`).
*   **‚ú® –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API.
*   **üßπ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏:** –ú–µ—Ç–æ–¥ `client.destroy()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.
*   **üß© –ü–ª–∞–≥–∏–Ω-—Å–∏—Å—Ç–µ–º–∞ –∏ Middleware:** –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–¥—Ä–∞.

### üöï –ü—Ä–∏–º–µ—Ä: –¢–∞–∫—Å–∏-–±–æ—Ç

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤. **–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `historyAdapter` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `require`.**

```javascript
// taxi-bot.js (CommonJS)
const { OpenRouterClient, MemoryHistoryStorage } = require("openrouter-kit");
const readline = require('readline').createInterface({
  input: process.stdin,
  output: process.stdout
});

const client = new OpenRouterClient({
  apiKey: process.env.OPENROUTER_API_KEY || "sk-or-v1-...",
  model: "google/gemini-2.0-flash-001",
  historyAdapter: new MemoryHistoryStorage(), // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
  enableCostTracking: true,
  debug: false, // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ true –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤
  // security: { /* ... */ } // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
});

let orderAccepted = false;

// --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ---
const taxiTools = [
  {
    type: "function",
    function: {
      name: "estimateRideCost",
      description: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏ –Ω–∞ —Ç–∞–∫—Å–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –∞–¥—Ä–µ—Å–∞–º–∏.",
      parameters: {
        type: "object",
        properties: {
          from: { type: "string", description: "–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, '—É–ª. –õ–µ–Ω–∏–Ω–∞, 1, –ú–æ—Å–∫–≤–∞')" },
          to: { type: "string", description: "–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, '—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 10, –ú–æ—Å–∫–≤–∞')" }
        },
        required: ["from", "to"]
      },
    },
    execute: async (args) => {
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç estimateRideCost] –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ—Ç ${args.from} –¥–æ ${args.to}...`);
      const cost = Math.floor(Math.random() * 900) + 100;
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç estimateRideCost] –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${cost} RUB`);
      return { estimatedCost: cost, currency: "RUB" };
    }
  },
  {
    type: "function",
    function: {
      name: "acceptOrder",
      description: "–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —Ç–∞–∫—Å–∏, –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è.",
      parameters: {
        type: "object",
        properties: {
          from: { type: "string", description: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è" },
          to: { type: "string", description: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è" },
          estimatedCost: { type: "number", description: "–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏ (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–∞)"}
        },
        required: ["from", "to"]
      },
    },
    execute: async (args, context) => {
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç acceptOrder] –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–∞ –æ—Ç ${args.from} –¥–æ ${args.to}...`);
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç acceptOrder] –ó–∞–∫–∞–∑ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: ${context?.userInfo?.userId || 'anonymous'}`);
      const driverNumber = Math.floor(Math.random() * 100) + 1;
      orderAccepted = true; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞
      return `–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç! –í–æ–¥–∏—Ç–µ–ª—å #${driverNumber} –Ω–∞–∑–Ω–∞—á–µ–Ω –∏ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç —É –≤–∞—Å –ø–æ –∞–¥—Ä–µ—Å—É ${args.from}. –ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${args.to}.`;
    }
  }
];

function askQuestion(query) {
  return new Promise((resolve) => {
    readline.question(query, (answer) => {
      resolve(answer);
    });
  });
}

const systemPrompt = `–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä —Å–ª—É–∂–±—ã —Ç–∞–∫—Å–∏ –ø–æ –∏–º–µ–Ω–∏ "–ö–∏—Ç". –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø–æ–º–æ—á—å –∫–ª–∏–µ–Ω—Ç—É –∑–∞–∫–∞–∑–∞—Ç—å —Ç–∞–∫—Å–∏.
1. –£—Ç–æ—á–Ω–∏ –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è ('from') –∏ –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è ('to'), –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∏—Ö –Ω–µ —É–∫–∞–∑–∞–ª. –ë—É–¥—å –≤–µ–∂–ª–∏–≤.
2. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã, –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç 'estimateRideCost', —á—Ç–æ–±—ã —Å–æ–æ–±—â–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å.
3. –î–æ–∂–¥–∏—Å—å, –ø–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç, —á—Ç–æ –µ–≥–æ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –æ–Ω –≥–æ—Ç–æ–≤ —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–≤–∞–º–∏ "–∑–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ", "—Ö–æ—Ä–æ—à–æ", "–¥–∞", "–ø–æ–¥—Ö–æ–¥–∏—Ç").
4. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç 'acceptOrder', –ø–µ—Ä–µ–¥–∞–≤ –µ–º—É –∞–¥—Ä–µ—Å–∞ 'from' –∏ 'to'.
5. –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ 'acceptOrder' —Å–æ–æ–±—â–∏ –∫–ª–∏–µ–Ω—Ç—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω—É–ª –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.
6. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –Ω–æ–º–µ—Ä–∞ –≤–æ–¥–∏—Ç–µ–ª–µ–π –∏–ª–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ —Å–∞–º, –ø–æ–ª–∞–≥–∞–π—Å—è –Ω–∞ –æ—Ç–≤–µ—Ç –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ 'acceptOrder'.
7. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —á—Ç–æ-—Ç–æ –Ω–µ –ø–æ —Ç–µ–º–µ –∑–∞–∫–∞–∑–∞ —Ç–∞–∫—Å–∏, –≤–µ–∂–ª–∏–≤–æ –≤–µ—Ä–Ω–∏ –µ–≥–æ –∫ —Ç–µ–º–µ.`;

async function chatWithTaxiBot() {
  const userId = `taxi-user-${Date.now()}`;
  console.log(`\n–ë–æ—Ç –ö–∏—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≤–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫... (ID —Å–µ—Å—Å–∏–∏: ${userId})`);

  try {
    while (!orderAccepted) {
      const userMessage = await askQuestion("–í—ã: ");
      if (userMessage.toLowerCase() === '–≤—ã—Ö–æ–¥' || userMessage.toLowerCase() === 'quit') {
          console.log("–ë–æ—Ç –ö–∏—Ç: –°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! –î–æ —Å–≤–∏–¥–∞–Ω–∏—è.");
          break;
      }

      console.log("–ë–æ—Ç –ö–∏—Ç: –ú–∏–Ω—É—Ç–∫—É, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –≤–∞—à –∑–∞–ø—Ä–æ—Å...");
      const result = await client.chat({
        user: userId, // –ö–ª—é—á –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
        prompt: userMessage,
        systemPrompt: systemPrompt,
        tools: taxiTools, // –ü–µ—Ä–µ–¥–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        temperature: 0.5,
        maxToolCalls: 5 // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
      });

      // –í—ã–≤–æ–¥–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
      console.log(`\n–ë–æ—Ç –ö–∏—Ç: ${result.content}\n`);

      // –í—ã–≤–æ–¥–∏–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
      if (client.isDebugMode()) {
          console.log(`[–û—Ç–ª–∞–¥–∫–∞] –ú–æ–¥–µ–ª—å: ${result.model}, –í—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä.: ${result.toolCallsCount}, –°—Ç–æ–∏–º–æ—Å—Ç—å: ${result.cost !== null ? '$' + result.cost.toFixed(8) : 'N/A'}, –ü—Ä–∏—á–∏–Ω–∞: ${result.finishReason}`);
          if (result.reasoning) console.log(`[–û—Ç–ª–∞–¥–∫–∞] –†–∞—Å—Å—É–∂–¥–µ–Ω–∏—è: ${result.reasoning}`);
          if (result.annotations && result.annotations.length > 0) console.log(`[–û—Ç–ª–∞–¥–∫–∞] –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏:`, result.annotations);
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º acceptOrder
      if (orderAccepted) {
        console.log("–ë–æ—Ç –ö–∏—Ç: –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã, —è –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å!");
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å break –∑–¥–µ—Å—å, –µ—Å–ª–∏ –¥–∏–∞–ª–æ–≥ –¥–æ–ª–∂–µ–Ω –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞
      }
    }
  } catch (error) {
    console.error("\n--- –ü—Ä–æ–∏–∑–æ—à–ª–∞ –û—à–∏–±–∫–∞ ---");
    if (error instanceof Error) {
        console.error(`–¢–∏–ø: ${error.constructor.name}`);
        console.error(`–°–æ–æ–±—â–µ–Ω–∏–µ: ${error.message}`);
        if ((error as any).code) console.error(`–ö–æ–¥: ${(error as any).code}`);
        if ((error as any).statusCode) console.error(`–°—Ç–∞—Ç—É—Å: ${(error as any).statusCode}`);
        if ((error as any).details) console.error(`–î–µ—Ç–∞–ª–∏:`, (error as any).details);
    } else {
        console.error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞:", error);
    }
  } finally {
    readline.close();
    await client.destroy(); // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
    console.log("\n–ö–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.");
  }
}

chatWithTaxiBot();
```

### ‚öôÔ∏è API –∏ –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏

#### `OpenRouterClient`

–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π.

##### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`OpenRouterConfig`)

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (`new OpenRouterClient(config)`) –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:

*   `apiKey` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): –í–∞—à API –∫–ª—é—á OpenRouter.
*   `apiEndpoint?` (string): URL —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –¥–ª—è —á–∞—Ç-–∫–æ–º–ø–ª–∏—à–µ–Ω–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `https://openrouter.ai/api/v1/chat/completions`).
*   `model?` (string): –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤.
*   `debug?` (boolean): –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`).
*   `proxy?` (string | object): –ù–∞—Å—Ç—Ä–æ–π–∫–∏ HTTP/HTTPS –ø—Ä–æ–∫—Å–∏.
*   `referer?` (string): –ó–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `HTTP-Referer`.
*   `title?` (string): –ó–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Title`.
*   `axiosConfig?` (object): –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Axios.
*   `historyAdapter?` (IHistoryStorage): **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏.** –≠–∫–∑–µ–º–ø–ª—è—Ä –∞–¥–∞–ø—Ç–µ—Ä–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏—Å—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `new MemoryHistoryStorage()`).
*   `historyTtl?` (number): –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ (TTL) –∑–∞–ø–∏—Å–µ–π –≤ –∫—ç—à–µ –∏—Å—Ç–æ—Ä–∏–∏ `UnifiedHistoryManager` (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö).
*   `historyCleanupInterval?` (number): –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ –∫—ç—à–∞ –∏—Å—Ç–æ—Ä–∏–∏ `UnifiedHistoryManager` (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö).
*   `defaultProviderRouting?` (ProviderRoutingConfig): –ü—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
*   `modelFallbacks?` (string[]): –°–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
*   `responseFormat?` (ResponseFormat | null): –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
*   `maxToolCalls?` (number): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞ –æ–¥–∏–Ω –≤—ã–∑–æ–≤ `chat()` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10).
*   `strictJsonParsing?` (boolean): –í—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º JSON –≤ –æ—Ç–≤–µ—Ç–µ (–µ—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω JSON —Ñ–æ—Ä–º–∞—Ç)? (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null`).
*   `security?` (SecurityConfig): –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑–æ–≤—ã–π —Ç–∏–ø `SecurityConfig` –∏–∑ `./types`).
*   `enableCostTracking?` (boolean): –í–∫–ª—é—á–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`).
*   `priceRefreshIntervalMs?` (number): –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 6 —á–∞—Å–æ–≤).
*   `initialModelPrices?` (object): –ù–∞—á–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –º–æ–¥–µ–ª–µ–π –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Ü–µ–Ω.
*   *–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–æ–ª—è:* `historyStorage`, `chatsFolder`, `maxHistoryEntries`, `historyAutoSave`, `enableReasoning`, `webSearch`.

##### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

*   `chat(options: OpenRouterRequestOptions): Promise<ChatCompletionResult>`: –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ —á–∞—Ç. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç `options` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞ (—Å–º. –Ω–∏–∂–µ).
*   `getHistoryManager(): UnifiedHistoryManager`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏.
*   `getSecurityManager(): SecurityManager | null`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
*   `getCostTracker(): CostTracker | null`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç—Ä–µ–∫–µ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏.
*   `getCreditBalance(): Promise<CreditBalance>`: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤.
*   `getModelPrices(): Record<string, ModelPricingInfo>`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—ç—à —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π.
*   `refreshModelPrices(): Promise<void>`: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫—ç—à —Ü–µ–Ω.
*   `createAccessToken(userInfo, expiresIn?): string`: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ).
*   `use(plugin): Promise<void>`: –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–ª–∞–≥–∏–Ω.
*   `useMiddleware(fn): void`: –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç middleware.
*   `on(event, handler)` / `off(event, handler)`: –ü–æ–¥–ø–∏—Å–∫–∞/–æ—Ç–ø–∏—Å–∫–∞ –æ—Ç —Å–æ–±—ã—Ç–∏–π.
*   `destroy(): Promise<void>`: –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã.

##### –û–ø—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ `client.chat` (`OpenRouterRequestOptions`)

–≠—Ç–∏ –æ–ø—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥ `client.chat()` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

*   `prompt?` (string): –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. **–ò–ª–∏** `customMessages` **–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**.
*   `customMessages?` (Message[] | null): –ü–æ–ª–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `prompt` –∏ –∏—Å—Ç–æ—Ä–∏—é). **–ò–ª–∏** `prompt` **–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**.
*   `user?` (string): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π (—Ç—Ä–µ–±—É–µ—Ç `historyAdapter`).
*   `group?` (string | null): ID –≥—Ä—É–ø–ø—ã –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å `user`).
*   `systemPrompt?` (string | null): –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞.
*   `accessToken?` (string | null): –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
*   `model?` (string): ID –º–æ–¥–µ–ª–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é). –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å `:online` –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–µ–±-–ø–æ–∏—Å–∫–∞.
*   `temperature?`, `maxTokens?`, `topP?`, `presencePenalty?`, `frequencyPenalty?`, `stop?`, `seed?`, `logitBias?`: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ LLM.
*   `tools?` (Tool[] | null): –ú–∞—Å—Å–∏–≤ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
*   `toolChoice?`: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –º–æ–¥–µ–ª—å—é (`'auto'`, `'none'`, `{ type: "function", function: { name: "..." } }`).
*   `parallelToolCalls?` (boolean): –†–∞–∑—Ä–µ—à–∏—Ç—å –º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
*   `maxToolCalls?` (number): –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–∏–º–∏—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
*   `responseFormat?` (ResponseFormat | null): –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (JSON Object –∏–ª–∏ JSON Schema).
*   `strictJsonParsing?` (boolean): –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å—Ç—Ä–æ–≥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ JSON –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
*   `provider?` (ProviderRoutingConfig): –ü—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
*   `models?` (string[]): –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π (–æ—Å–Ω–æ–≤–Ω–∞—è + —Ñ–æ–ª–ª–±—ç–∫–∏) –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
*   `plugins?` (PluginConfig[]): –°–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `[{ id: 'web', max_results: 3 }]`).
*   `reasoning?` (ReasoningConfig): –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π (`effort`, `max_tokens`, `exclude`).
*   `transforms?` (string[]): –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ OpenRouter (–Ω–∞–ø—Ä–∏–º–µ—Ä, `["middle-out"]`).
*   `route?`: –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ OpenRouter.

##### –†–µ–∑—É–ª—å—Ç–∞—Ç `client.chat` (`ChatCompletionResult`)

–ú–µ—Ç–æ–¥ `client.chat()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Promise`, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç `ChatCompletionResult` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏:

*   `content` (any): –§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏ (—Å—Ç—Ä–æ–∫–∞, –æ–±—ä–µ–∫—Ç JSON –∏ —Ç.–¥., –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞).
*   `usage` (UsageInfo | null): –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (–ø—Ä–æ–º–ø—Ç + –æ—Ç–≤–µ—Ç, –≤–∫–ª—é—á–∞—è –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤).
*   `model` (string): ID –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä–∞—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.
*   `toolCallsCount` (number): –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
*   `finishReason` (string | null): –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (`'stop'`, `'length'`, `'tool_calls'`, `'content_filter'`, `null`).
*   `durationMs` (number): –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ `chat()` –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö.
*   `id?` (string): ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —à–∞–≥–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç API OpenRouter.
*   `cost?` (number | null): –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –ø—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ (–µ—Å–ª–∏ `enableCostTracking: true`).
*   `reasoning?` (string | null): –°—Ç—Ä–æ–∫–∞ —Å —à–∞–≥–∞–º–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –º–æ–¥–µ–ª–∏ (–µ—Å–ª–∏ –±—ã–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω—ã –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã).
*   `annotations?` (UrlCitationAnnotation[]): –ú–∞—Å—Å–∏–≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ü–∏—Ç–∞—Ç –≤–µ–±-–ø–æ–∏—Å–∫–∞), —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º.

#### üß© –ü–ª–∞–≥–∏–Ω—ã –∏ Middleware

*   **–ü–ª–∞–≥–∏–Ω—ã:** –ú–æ–¥—É–ª–∏, —Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–∞. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `client.use(plugin)`. –ú–æ–≥—É—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã, –∑–∞–º–µ–Ω—è—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã (`setSecurityManager`, `setCostTracker`), –¥–æ–±–∞–≤–ª—è—Ç—å middleware.
*   **Middleware:** –§—É–Ω–∫—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–µ—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞ `client.chat()`. –ü–æ–∑–≤–æ–ª—è—é—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å (`ctx.request`), –æ—Ç–≤–µ—Ç (`ctx.response`) –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–±–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞—É–¥–∏—Ç). –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `client.useMiddleware(fn)`.

#### üìú –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π (–ê–¥–∞–ø—Ç–µ—Ä—ã)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤ **–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å `historyAdapter`** –≤ `OpenRouterConfig`.

*   **–ê–¥–∞–ø—Ç–µ—Ä (`IHistoryStorage`):** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (`load`, `save`, `delete`, `listKeys`, `destroy?`).
*   **`UnifiedHistoryManager`:** –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –∞–¥–∞–ø—Ç–µ—Ä –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ –ø–∞–º—è—Ç–∏.
*   **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã:** `MemoryHistoryStorage`, `DiskHistoryStorage`.
*   **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
    ```typescript
    import { OpenRouterClient, MemoryHistoryStorage } from 'openrouter-kit';
    const client = new OpenRouterClient({ /*...,*/ historyAdapter: new MemoryHistoryStorage() });
    ```
*   **–ü–ª–∞–≥–∏–Ω –¥–ª—è Redis:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `createRedisHistoryPlugin`.
*   **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∞:** `historyTtl`, `historyCleanupInterval`.

#### üõ†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Function Calling)

–ü–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–µ–ª—è–º LLM –≤—ã–∑—ã–≤–∞—Ç—å –≤–∞—à–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

1.  **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (`Tool`):** –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –æ–±—ä–µ–∫—Ç —Å `type: 'function'`, `function: { name, description?, parameters? }` (JSON Schema –¥–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤) –∏ –≤–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–µ–π `execute: (args, context?) => Promise<any> | any`. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ `security` –ø—Ä–∞–≤–∏–ª–∞.
2.  **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `client.chat()`:** –ü–µ—Ä–µ–¥–∞–π—Ç–µ –º–∞—Å—Å–∏–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ `options.tools`. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    *   –û—Ç–ø—Ä–∞–≤–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏.
    *   –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–∑–æ–≤ (`finish_reason: 'tool_calls'`).
    *   –†–∞—Å–ø–∞—Ä—Å–∏—Ç –∏ –ø—Ä–æ–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã.
    *   **–í—ã–ø–æ–ª–Ω–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (`SecurityManager`).
    *   –í—ã–∑–æ–≤–µ—Ç –≤–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é `execute`.
    *   **–û—Ç–ø—Ä–∞–≤–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É) –æ–±—Ä–∞—Ç–Ω–æ –º–æ–¥–µ–ª–∏.**
    *   –í–µ—Ä–Ω–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
3.  **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –≤ `ChatCompletionResult.content`, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –≤ `ChatCompletionResult.toolCallsCount`.

#### üîí –ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (`SecurityManager`)

–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–µ–π –æ–±—ä–µ–∫—Ç–∞ `security: SecurityConfig` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `OpenRouterClient`. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞, rate limiting –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤. –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –æ—Å–æ–±–µ–Ω–Ω–æ `userAuthentication.jwtSecret`. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Rate Limiter –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.**

#### üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (Cost Tracking)

–í–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `enableCostTracking: true`. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç **–ø—Ä–∏–º–µ—Ä–Ω—É—é** —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–∑–æ–≤–æ–≤ `chat()` –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö `usage` –∏ –∫—ç—à–∏—Ä—É–µ–º—ã—Ö —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã `getCreditBalance()`, `getModelPrices()`, `refreshModelPrices()`.

#### üîÑ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (–ú–æ–¥–µ–ª–∏ –∏ –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã)

*   **–ú–æ–¥–µ–ª–∏:** –ó–∞–¥–∞–≤–∞–π—Ç–µ —Å–ø–∏—Å–æ–∫ —Ñ–æ–ª–ª–±—ç–∫-–º–æ–¥–µ–ª–µ–π –≤ `OpenRouterConfig` (`modelFallbacks`) –∏–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤ `OpenRouterRequestOptions` (`models`). –°–ø–∏—Å–æ–∫ `models` –≤ –∑–∞–ø—Ä–æ—Å–µ –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
*   **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã:** –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤—ã–±–æ—Ä–æ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —á–µ—Ä–µ–∑ `defaultProviderRouting` –≤ `OpenRouterConfig` –∏–ª–∏ `provider` –≤ `OpenRouterRequestOptions`. –û–ø—Ü–∏—è `provider` –≤ –∑–∞–ø—Ä–æ—Å–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ (`order`), –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ñ–æ–ª–ª–±—ç–∫–∏ (`allow_fallbacks`), –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (`ignore`), —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (`require_parameters`), —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ –¥–∞–Ω–Ω—ã—Ö (`data_collection`) –∏–ª–∏ –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏–∏ (`quantizations`), —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å (`sort`).

#### üåê –í–µ–±-–ø–æ–∏—Å–∫

*   **–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
    *   –î–æ–±–∞–≤—å—Ç–µ —Å—É—Ñ—Ñ–∏–∫—Å `:online` –∫ –∏–º–µ–Ω–∏ –º–æ–¥–µ–ª–∏ –≤ `options.model` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'openai/gpt-4o-mini:online'`).
    *   –ò–ª–∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –ø–ª–∞–≥–∏–Ω –≤ `options.plugins`: `plugins: [{ id: 'web' }]`. –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `max_results` –∏ `search_prompt`: `plugins: [{ id: 'web', max_results: 3 }]`.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–µ–±-–ø–æ–∏—Å–∫–∞. –°—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ø–æ–ª–µ `ChatCompletionResult.annotations`.

#### ü§î –¢–æ–∫–µ–Ω—ã –†–∞—Å—Å—É–∂–¥–µ–Ω–∏–π (Reasoning Tokens)

*   **–ó–∞–ø—Ä–æ—Å:** –ü–µ—Ä–µ–¥–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç `reasoning` –≤ `options` –º–µ—Ç–æ–¥–∞ `client.chat()`.
    *   `effort`: `'low'`, `'medium'` –∏–ª–∏ `'high'`.
    *   `max_tokens`: –ß–∏—Å–ª–æ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π.
    *   `exclude`: `true`, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å —Ä–∞—Å—Å—É–∂–¥–∞–ª–∞, –Ω–æ –Ω–µ –≤–∫–ª—é—á–∞–ª–∞ —ç—Ç–æ –≤ –æ—Ç–≤–µ—Ç.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –®–∞–≥–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –ø–æ–ª–µ `ChatCompletionResult.reasoning` (–µ—Å–ª–∏ `exclude: false`).

#### ‚öôÔ∏è –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (`responseFormat` –∏ Structured Outputs)

–ó–∞–ø—Ä–æ—Å–∏—Ç–µ –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.

*   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –û–ø—Ü–∏—è `responseFormat` –≤ `OpenRouterConfig` –∏–ª–∏ `OpenRouterRequestOptions`.
*   **–¢–∏–ø—ã:**
    *   `{ type: 'json_object' }`: –õ—é–±–æ–π –≤–∞–ª–∏–¥–Ω—ã–π JSON.
    *   `{ type: 'json_schema', json_schema: { name: string, schema: object, strict?: boolean, description?: string } }`: JSON, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –≤–∞—à–µ–π —Å—Ö–µ–º–µ. –§–ª–∞–≥ `strict` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ API, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω.
*   **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç `strictJsonParsing` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false` - –≤–µ—Ä–Ω–µ—Ç `null`, `true` - –≤—ã–±—Ä–æ—Å–∏—Ç `ValidationError`).

#### ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `try...catch` –∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `instanceof` –∏–ª–∏ `error.code` (`ErrorCode`). –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏–µ `'error'` –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

#### üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `debug: true`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `console` —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

#### üåê –ü—Ä–æ–∫—Å–∏

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ–ø—Ü–∏—é `proxy` (URL —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –æ–±—ä–µ–∫—Ç `{ host, port, user?, pass? }`) –≤ `OpenRouterConfig`.

### üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

[MIT](./LICENSE)
