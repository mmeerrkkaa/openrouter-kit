# OpenRouter Kit

[![–í–µ—Ä—Å–∏—è npm](https://badge.fury.io/js/openrouter-kit.svg)](https://badge.fury.io/js/openrouter-kit) [![–õ–∏—Ü–µ–Ω–∑–∏—è: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT) [![TypeScript](https://img.shields.io/badge/%3C/%3E-TypeScript-%230074C1.svg)](http://www.typescriptlang.org/)

**üá∑üá∫ –†—É—Å—Å–∫–∏–π** | [üá¨üáß English](./README.en.md) <!-- –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –∞–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è –±—É–¥–µ—Ç –≤ README.en.md -->
---

**OpenRouter Kit** ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è, –≥–∏–±–∫–∞—è –∏ —É–¥–æ–±–Ω–∞—è TypeScript/JavaScript –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å [OpenRouter API](https://openrouter.ai/). –û–Ω–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å LLM, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API –¥–ª—è —á–∞—Ç–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤, –±–µ—Å—à–æ–≤–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (function calling), –Ω–∞–¥–µ–∂–Ω—ã–π –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –º–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∞ —Ç–∞–∫–∂–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç-–±–æ—Ç–æ–≤, –ò–ò-–∞–≥–µ–Ω—Ç–æ–≤ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ LLM –≤ –≤–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenRouter Kit?

*   **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –°–ª–æ–∂–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å–∫—Ä—ã—Ç—ã –∑–∞ –ø—Ä–æ—Å—Ç—ã–º –º–µ—Ç–æ–¥–æ–º `client.chat()`.
*   **–ì–∏–±–∫–æ—Å—Ç—å:** –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –º–æ–¥–µ–ª–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–º–æ–≥–∞–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å –≤–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
*   **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–ª–∞–≥–∏–Ω—ã –∏ middleware –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –ª–æ–≥–∏–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–¥—Ä–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.
*   **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ TypeScript, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏.

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

*   [üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–∫–ª—é—á–µ–≤—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
*   [üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
*   [‚ú® –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#-–±–∞–∑–æ–≤–æ–µ-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
*   [üöï –ü—Ä–∏–º–µ—Ä: –¢–∞–∫—Å–∏-–±–æ—Ç](#-–ø—Ä–∏–º–µ—Ä-—Ç–∞–∫—Å–∏-–±–æ—Ç)
*   [‚öôÔ∏è API –∏ –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏](#Ô∏è-api-–∏-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
    *   [OpenRouterClient](#openrouterclient)
        *   [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (OpenRouterConfig)](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-openrouterconfig)
        *   [–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–º–µ—Ç–æ–¥—ã)
    *   [–ü–ª–∞–≥–∏–Ω—ã –∏ Middleware](#-–ø–ª–∞–≥–∏–Ω—ã-–∏-middleware)
    *   [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π (–ê–¥–∞–ø—Ç–µ—Ä—ã)](#-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∏—Å—Ç–æ—Ä–∏–µ–π-–∞–¥–∞–ø—Ç–µ—Ä—ã)
    *   [–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Function Calling)](#-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤-function-calling)
    *   [–ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SecurityManager)](#-–º–æ–¥—É–ª—å-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏-securitymanager)
    *   [–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (Cost Tracking)](#-–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ-—Å—Ç–æ–∏–º–æ—Å—Ç–∏-cost-tracking)
    *   [–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (responseFormat)](#Ô∏è-—Ñ–æ—Ä–º–∞—Ç-–æ—Ç–≤–µ—Ç–∞-responseformat)
    *   [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#Ô∏è-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
    *   [–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
    *   [–ü—Ä–æ–∫—Å–∏](#-–ø—Ä–æ–∫—Å–∏)
*   [üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è](#-–ª–∏—Ü–µ–Ω–∑–∏—è)

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **ü§ñ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —á–∞—Ç:** –ü—Ä–æ—Å—Ç–æ–π –∏ –º–æ—â–Ω—ã–π API (`client.chat`) –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ª—é–±–æ–π –º–æ–¥–µ–ª—å—é, –¥–æ—Å—Ç—É–ø–Ω–æ–π —á–µ—Ä–µ–∑ OpenRouter.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `ChatCompletionResult` —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (`content`), –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö (`usage`), –º–æ–¥–µ–ª—å—é (`model`), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`toolCallsCount`), –ø—Ä–∏—á–∏–Ω–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (`finishReason`), –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (`durationMs`), ID –∑–∞–ø—Ä–æ—Å–∞ (`id`) –∏ **—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é** (`cost`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
*   **üìú –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±—Ä–µ–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –≥—Ä—É–ø–ø—ã.
    *   –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ –±–∞–∑–µ **–∞–¥–∞–ø—Ç–µ—Ä–æ–≤** (`IHistoryStorage`).
    *   –í –∫–æ–º–ø–ª–µ–∫—Ç–µ ‚Äî –∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –ø–∞–º—è—Ç–∏ (`MemoryHistoryStorage`) –∏ –¥–∏—Å–∫–∞ (`DiskHistoryStorage`, JSON-—Ñ–∞–π–ª—ã).
    *   –õ–µ–≥–∫–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å —Å–≤–æ–∏ –∞–¥–∞–ø—Ç–µ—Ä—ã (Redis, MongoDB, API –∏ –¥—Ä.).
    *   –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TTL, –ª–∏–º–∏—Ç–æ–≤, –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –æ—á–∏—Å—Ç–∫–∏.
*   **üõ†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Function Calling):** –ë–µ—Å—à–æ–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ –≤–∞—à–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –º–æ–¥–µ–ª—å—é.
    *   –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é `Tool` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ JSON Schema –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ —Å—Ö–µ–º–µ –∏ **–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**.
    *   –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–∞—à–∏—Ö `execute` —Ñ—É–Ω–∫—Ü–∏–π —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`ToolContext`, –≤–∫–ª—é—á–∞—è `userInfo`).
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
    *   –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ª–∏–º–∏—Ç –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`maxToolCalls`) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è.
*   **üõ°Ô∏è –ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è –≤–∞—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
    *   **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ JWT (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ) —á–µ—Ä–µ–∑ `AuthManager`. –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤ (`api-key`, `custom`).
    *   **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ (ACL):** –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º (`AccessControlManager`) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π (`roles`), API-–∫–ª—é—á–µ–π (`allowedApiKeys`), —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (`scopes`) –∏–ª–∏ —è–≤–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª (`allow`/`deny`). –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`deny-all`/`allow-all`).
    *   **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã (Rate Limiting):** –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ (`RateLimitManager`) –Ω–∞ –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ —Ä–æ–ª–µ–π, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–µ—Ä–∏–æ–¥—ã –∏ –ª–∏–º–∏—Ç—ã.
    *   **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:** –ü—Ä–æ–≤–µ—Ä–∫–∞ (`ArgumentSanitizer`) –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (SQLi, XSS, command injection –∏ —Ç.–¥.) —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–∞ –∞—É–¥–∏—Ç–∞ (`auditOnlyMode`).
    *   **–°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π:** –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (`access:denied`, `ratelimit:exceeded`, `security:dangerous_args`, `token:invalid`, `user:authenticated` –∏ –¥—Ä.) –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
*   **üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (Cost Tracking):** (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞ `chat()` –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö (`usage`) –∏ —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π OpenRouter.
    *   –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Ñ–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π –∏–∑ API OpenRouter (`/models`).
    *   –ú–µ—Ç–æ–¥ `getCreditBalance()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤ OpenRouter.
    *   –î–æ—Å—Ç—É–ø –∫ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ü–µ–Ω–∞–º —á–µ—Ä–µ–∑ `getModelPrices()`.
*   **‚öôÔ∏è –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞, –º–æ–¥–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, —Ç–∞–π–º–∞—É—Ç–æ–≤, **–ø—Ä–æ–∫—Å–∏**, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (`Referer`, `X-Title`), —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (`modelFallbacks`), —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞ (`responseFormat`), –ª–∏–º–∏—Ç–∞ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`maxToolCalls`), –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (`enableCostTracking`) –∏ –º–Ω–æ–≥–∏—Ö –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ `OpenRouterConfig`.
*   **üí° –¢–∏–ø–∏–∑–∞—Ü–∏—è:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ TypeScript, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é, –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
*   **üö¶ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –ü–æ–Ω—è—Ç–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ—à–∏–±–æ–∫ (`APIError`, `ValidationError`, `SecurityError`, `RateLimitError`, `ToolError`, `ConfigError` –∏ –¥—Ä.), –Ω–∞—Å–ª–µ–¥—É–µ–º—ã—Ö –æ—Ç `OpenRouterError`, —Å –∫–æ–¥–∞–º–∏ (`ErrorCode`) –∏ –¥–µ—Ç–∞–ª—è–º–∏ –¥–ª—è —É–¥–æ–±–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. –§—É–Ω–∫—Ü–∏—è `mapError` –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫.
*   **üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≥–∏–±–∫–∏–π –ª–æ–≥–≥–µ—Ä (`Logger`) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –∏ —Ä–µ–∂–∏–º–∞ –æ—Ç–ª–∞–¥–∫–∏ (`debug`).
*   **‚ú® –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API, —Å–∫—Ä—ã–≤–∞—é—â–∏–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å –±–∞–∑–æ–≤—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å LLM, –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.
*   **üßπ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏:** –ú–µ—Ç–æ–¥ `client.destroy()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ (—Ç–∞–π–º–µ—Ä—ã –æ—á–∏—Å—Ç–∫–∏, –∫—ç—à–∏, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π), –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è —É—Ç–µ—á–∫–∏ –≤ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
*   **üß© –ü–ª–∞–≥–∏–Ω-—Å–∏—Å—Ç–µ–º–∞:** –†–∞—Å—à–∏—Ä—è–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–¥—Ä–∞.
    *   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ `client.use(plugin)`.
    *   –ü–ª–∞–≥–∏–Ω—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å middleware, –∑–∞–º–µ–Ω—è—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—ã (–∏—Å—Ç–æ—Ä–∏–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Å—Ç–æ–∏–º–æ—Å—Ç–∏), –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å API –∫–ª–∏–µ–Ω—Ç–∞.
*   **üîó Middleware-—Ü–µ–ø–æ—á–∫–∞:** –ì–∏–±–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ API.
    *   –î–æ–±–∞–≤–ª—è–π—Ç–µ middleware-—Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ `client.useMiddleware(fn)`.
    *   Middleware –º–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã (`ctx.request`), –æ—Ç–≤–µ—Ç—ã (`ctx.response`), —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—É–¥–∏—Ç, –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install openrouter-kit
# –∏–ª–∏
yarn add openrouter-kit
# –∏–ª–∏
pnpm add openrouter-kit
```

## ‚ú® –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**TypeScript:**

```typescript
import OpenRouter from 'openrouter-kit';
// –∏–ª–∏ –¥–ª—è CommonJS: const { OpenRouterClient } = require('openrouter-kit');

const client = new OpenRouter({
  apiKey: process.env.OPENROUTER_API_KEY || 'sk-or-v1-...', // –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è!
  enableCostTracking: true, // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  debug: false,             // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
});

async function main() {
  try {
    console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
    const result = await client.chat({ // –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç ChatCompletionResult
      prompt: '–ü–µ—Ä–µ–¥–∞–π –ø—Ä–∏–≤–µ—Ç –º–∏—Ä—É!',
      model: 'google/gemini-2.0-flash-001', // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–¥–µ–ª—å
      user: 'test-user-1', // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
    });

    console.log('--- –†–µ–∑—É–ª—å—Ç–∞—Ç ---');
    console.log('–û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏:', result.content); // –î–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É —á–µ—Ä–µ–∑ .content
    console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤:', result.usage);
    console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å:', result.model);
    console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:', result.toolCallsCount);
    console.log('–ü—Ä–∏—á–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:', result.finishReason);
    console.log('–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–º—Å):', result.durationMs);
    if (result.cost !== null) {
      console.log('–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (USD):', result.cost.toFixed(8));
    }
    console.log('ID –ó–∞–ø—Ä–æ—Å–∞:', result.id);

    // –ü—Ä–∏–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ (–µ—Å–ª–∏ –∫–ª—é—á –≤–∞–ª–∏–¥–Ω—ã–π)
    console.log('\n–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞...');
    const balance = await client.getCreditBalance();
    console.log(`–ë–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ $${balance.usage.toFixed(4)} –∏–∑ $${balance.limit.toFixed(2)}`);

    // –ü—Ä–∏–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ (–µ—Å–ª–∏ user –±—ã–ª —É–∫–∞–∑–∞–Ω)
    const historyManager = client.getHistoryManager(); // –ü–æ–ª—É—á–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
    if (historyManager && typeof historyManager.getHistory === 'function') { // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —ç—Ç–æ UnifiedHistoryManager
        const history = await historyManager.getHistory('user:test-user-1'); // –ö–ª—é—á —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ
        console.log(`\n–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è user:test-user-1: ${history.length}`);
    }


  } catch (error: any) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (—Å–º. —Ä–∞–∑–¥–µ–ª "–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫")
    console.error(`\n--- –û—à–∏–±–∫–∞ ---`);
    console.error(`–°–æ–æ–±—â–µ–Ω–∏–µ: ${error.message}`);
    if (error.code) {
        console.error(`–ö–æ–¥ –æ—à–∏–±–∫–∏: ${error.code}`);
    }
    if (error.statusCode) {
        console.error(`HTTP –°—Ç–∞—Ç—É—Å: ${error.statusCode}`);
    }
    if (error.details) {
        console.error(`–î–µ—Ç–∞–ª–∏:`, error.details);
    }
    // console.error(error.stack); // –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  } finally {
    console.log('\n–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤...');
    // –í–∞–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã (—Ç–∞–π–º–µ—Ä—ã, –∫—ç—à–∏)
    await client.destroy();
    console.log('–†–µ—Å—É—Ä—Å—ã –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã.');
  }
}

main();
```

**JavaScript (CommonJS):**

```javascript
const { OpenRouterClient } = require("openrouter-kit");

const client = new OpenRouterClient({
  apiKey: process.env.OPENROUTER_API_KEY || 'sk-or-v1-...',
  enableCostTracking: true, // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
});

async function main() {
  try {
    const result = await client.chat({ prompt: 'Hello, world!' });
    console.log('–û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏:', result.content);
    console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:', result.usage);
    console.log('–°—Ç–æ–∏–º–æ—Å—Ç—å:', result.cost); // null –µ—Å–ª–∏ enableCostTracking: false
  } catch (error) {
     console.error(`–û—à–∏–±–∫–∞: ${error.message}`, error.details || error);
  } finally {
     // –í–∞–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
     await client.destroy();
  }
}

main();
```

## üöï –ü—Ä–∏–º–µ—Ä: –¢–∞–∫—Å–∏-–±–æ—Ç

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (function calling) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –±–æ—Ç–∞-–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Ç–∞–∫—Å–∏.

```javascript
// taxi-bot.js (CommonJS)
const { OpenRouterClient } = require("openrouter-kit");
const readline = require('readline').createInterface({
  input: process.stdin,
  output: process.stdout
});

// –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∫—Å–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
// const proxyConfig = {
//   host: "your.proxy.server",
//   port: 8080, // –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ —á–∏—Å–ª–æ–º
//   user: "proxy_user", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
//   pass: "proxy_pass", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
// };

const client = new OpenRouterClient({
  apiKey: process.env.OPENROUTER_API_KEY || "sk-or-v1-...", // –ó–∞–º–µ–Ω–∏—Ç–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ env!
  model: "google/gemini-2.0-flash-001", // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–∞–ø—Ç–µ—Ä –ø–∞–º—è—Ç–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  // historyAdapter: new MemoryHistoryStorage(), // –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—é –∏–ª–∏ historyStorage: 'memory'
  // proxy: proxyConfig, // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–æ–∫—Å–∏
  enableCostTracking: true, // –í–∫–ª—é—á–∞–µ–º —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  debug: false, // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ true –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ø—Ä–∏–º–µ—Ä):
  // security: {
  //   defaultPolicy: 'deny-all', // –ó–∞–ø—Ä–µ—â–∞—Ç—å –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  //   toolAccess: { // –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
  //       'estimateRideCost': { allow: true },
  //       'acceptOrder': { allow: true },
  //   }
  // }
});

let orderAccepted = false; // –§–ª–∞–≥ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞

// --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ---
const taxiTools = [
  {
    type: "function",
    function: {
      name: "estimateRideCost",
      description: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏ –Ω–∞ —Ç–∞–∫—Å–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –∞–¥—Ä–µ—Å–∞–º–∏.",
      parameters: {
        type: "object",
        properties: {
          from: { type: "string", description: "–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, '—É–ª. –õ–µ–Ω–∏–Ω–∞, 1, –ú–æ—Å–∫–≤–∞')" },
          to: { type: "string", description: "–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, '—É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 10, –ú–æ—Å–∫–≤–∞')" }
        },
        required: ["from", "to"]
      },
    },
    // –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
    execute: async (args) => {
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç estimateRideCost] –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ—Ç ${args.from} –¥–æ ${args.to}...`);
      // –°–∏–º—É–ª—è—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
      const cost = Math.floor(Math.random() * 900) + 100; // –°–ª—É—á–∞–π–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç 100 –¥–æ 999
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç estimateRideCost] –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${cost} RUB`);
      // –í–∞–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª—å —Å–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
      return {
        estimatedCost: cost,
        currency: "RUB"
      };
    }
  },
  {
    type: "function",
    function: {
      name: "acceptOrder",
      description: "–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —Ç–∞–∫—Å–∏, –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è.",
      parameters: {
        type: "object",
        properties: {
          from: { type: "string", description: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è" },
          to: { type: "string", description: "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è" },
          // –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å, –µ—Å–ª–∏ –µ–µ –ø–æ–º–Ω–∏—Ç
          estimatedCost: { type: "number", description: "–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏ (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–∞)"}
        },
        required: ["from", "to"]
      },
    },
    // –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
    execute: async (args, context) => { // –î–æ—Å—Ç—É–ø–µ–Ω context
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç acceptOrder] –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–∞ –æ—Ç ${args.from} –¥–æ ${args.to}...`);
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç acceptOrder] –ó–∞–∫–∞–∑ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: ${context?.userInfo?.userId || 'anonymous'}`); // –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è context
      const driverNumber = Math.floor(Math.random() * 100) + 1;
      orderAccepted = true; // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–ª–∞–≥ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–¥–µ–ª—å –ø–µ—Ä–µ–¥–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      // –≠—Ç–æ –ª—É—á—à–µ, —á–µ–º –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç —Å–∞–º–∞ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –Ω–æ–º–µ—Ä –≤–æ–¥–∏—Ç–µ–ª—è
      return `–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç! –í–æ–¥–∏—Ç–µ–ª—å #${driverNumber} –Ω–∞–∑–Ω–∞—á–µ–Ω –∏ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç —É –≤–∞—Å –ø–æ –∞–¥—Ä–µ—Å—É ${args.from}. –ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${args.to}.`;
    }
  }
];

function askQuestion(query) {
  return new Promise((resolve) => {
    readline.question(query, (answer) => {
      resolve(answer);
    });
  });
}

// –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –º–æ–¥–µ–ª–∏
const systemPrompt = `–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä —Å–ª—É–∂–±—ã —Ç–∞–∫—Å–∏ –ø–æ –∏–º–µ–Ω–∏ "–ö–∏—Ç". –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø–æ–º–æ—á—å –∫–ª–∏–µ–Ω—Ç—É –∑–∞–∫–∞–∑–∞—Ç—å —Ç–∞–∫—Å–∏.
1. –£—Ç–æ—á–Ω–∏ –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è ('from') –∏ –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è ('to'), –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∏—Ö –Ω–µ —É–∫–∞–∑–∞–ª. –ë—É–¥—å –≤–µ–∂–ª–∏–≤.
2. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã, –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç 'estimateRideCost', —á—Ç–æ–±—ã —Å–æ–æ–±—â–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å.
3. –î–æ–∂–¥–∏—Å—å, –ø–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç, —á—Ç–æ –µ–≥–æ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –æ–Ω –≥–æ—Ç–æ–≤ —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–≤–∞–º–∏ "–∑–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ", "—Ö–æ—Ä–æ—à–æ", "–¥–∞", "–ø–æ–¥—Ö–æ–¥–∏—Ç").
4. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç 'acceptOrder', –ø–µ—Ä–µ–¥–∞–≤ –µ–º—É –∞–¥—Ä–µ—Å–∞ 'from' –∏ 'to'.
5. –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ 'acceptOrder' —Å–æ–æ–±—â–∏ –∫–ª–∏–µ–Ω—Ç—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω—É–ª –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.
6. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –Ω–æ–º–µ—Ä–∞ –≤–æ–¥–∏—Ç–µ–ª–µ–π –∏–ª–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ —Å–∞–º, –ø–æ–ª–∞–≥–∞–π—Å—è –Ω–∞ –æ—Ç–≤–µ—Ç –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ 'acceptOrder'.
7. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —á—Ç–æ-—Ç–æ –Ω–µ –ø–æ —Ç–µ–º–µ –∑–∞–∫–∞–∑–∞ —Ç–∞–∫—Å–∏, –≤–µ–∂–ª–∏–≤–æ –≤–µ—Ä–Ω–∏ –µ–≥–æ –∫ —Ç–µ–º–µ.`;

async function chatWithTaxiBot() {
  // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏)
  const userId = `taxi-user-${Date.now()}`;
  console.log(`\n–ë–æ—Ç –ö–∏—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≤–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∑–∞–∫–∞–∑—É —Ç–∞–∫—Å–∏. –ö—É–¥–∞ –ø–æ–µ–¥–µ–º? (ID —Å–µ—Å—Å–∏–∏: ${userId})`);

  try {
    while (!orderAccepted) {
      const userMessage = await askQuestion("–í—ã: ");
      if (userMessage.toLowerCase() === '–≤—ã—Ö–æ–¥' || userMessage.toLowerCase() === 'quit') {
          console.log("–ë–æ—Ç –ö–∏—Ç: –°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! –î–æ —Å–≤–∏–¥–∞–Ω–∏—è.");
          break;
      }

      console.log("–ë–æ—Ç –ö–∏—Ç: –ú–∏–Ω—É—Ç–∫—É, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –≤–∞—à –∑–∞–ø—Ä–æ—Å...");
      const result = await client.chat({
        user: userId, // –í–∫–ª—é—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        prompt: userMessage,
        systemPrompt: systemPrompt,
        tools: taxiTools, // –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–¥–µ–ª–∏
        model: "openai/gpt-4o-mini", // –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
        temperature: 0.5, // –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∏–º –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏
        maxToolCalls: 5 // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
      });

      // –í—ã–≤–æ–¥–∏–º –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏
      console.log(`\n–ë–æ—Ç –ö–∏—Ç: ${result.content}\n`);

      // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      if (client.isDebugMode()) { // –ò—Å–ø–æ–ª—å–∑—É–µ–º isDebugMode() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
          console.log(`[–û—Ç–ª–∞–¥–∫–∞] –ú–æ–¥–µ–ª—å: ${result.model}, –í—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä.: ${result.toolCallsCount}, –°—Ç–æ–∏–º–æ—Å—Ç—å: ${result.cost !== null ? '$' + result.cost.toFixed(8) : 'N/A'}, –ü—Ä–∏—á–∏–Ω–∞: ${result.finishReason}`);
      }

      // –ï—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç acceptOrder –±—ã–ª —É—Å–ø–µ—à–Ω–æ –≤—ã–∑–≤–∞–Ω (–ø–æ —Ñ–ª–∞–≥—É)
      if (orderAccepted) {
        // –°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞ —É–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ result.content,
        // —Ç.–∫. –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É –∏–∑ execute() –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ acceptOrder.
        console.log("–ë–æ—Ç –ö–∏—Ç: –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã, —è –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å!");
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å break –∑–¥–µ—Å—å, –µ—Å–ª–∏ –¥–∏–∞–ª–æ–≥ –¥–æ–ª–∂–µ–Ω –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞
        // break;
      }
    }
  } catch (error) {
    console.error("\n--- –ü—Ä–æ–∏–∑–æ—à–ª–∞ –û—à–∏–±–∫–∞ ---");
    if (error instanceof Error) {
        console.error(`–¢–∏–ø: ${error.constructor.name}`);
        console.error(`–°–æ–æ–±—â–µ–Ω–∏–µ: ${error.message}`);
        if (error.code) console.error(`–ö–æ–¥: ${error.code}`);
        if (error.statusCode) console.error(`–°—Ç–∞—Ç—É—Å: ${error.statusCode}`);
        if (error.details) console.error(`–î–µ—Ç–∞–ª–∏:`, error.details);
    } else {
        console.error("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞:", error);
    }
  } finally {
    readline.close();
    // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã –∫–ª–∏–µ–Ω—Ç–∞
    await client.destroy();
    console.log("\n–ö–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.");
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
chatWithTaxiBot();
```

## ‚öôÔ∏è API –∏ –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏

### `OpenRouterClient`

–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π.

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`OpenRouterConfig`)

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (`new OpenRouterClient(config)`) –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –ø–æ–ª—è–º–∏:

*   `apiKey` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): –í–∞—à API –∫–ª—é—á OpenRouter. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`process.env.OPENROUTER_API_KEY`).
*   `model` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'google/gemini-2.0-flash-001'`).
*   `debug` (boolean, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`).
*   `historyAdapter` (IHistoryStorage, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –≠–∫–∑–µ–º–ø–ª—è—Ä –∞–¥–∞–ø—Ç–µ—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `new DiskHistoryStorage('./my-chats')`). –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MemoryHistoryStorage`.
*   `historyAutoSave` (boolean, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, `DiskHistoryStorage`).
*   `historyTtl` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 24 —á–∞—Å–∞). –ó–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ.
*   `historyCleanupInterval` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ö–∞–∫ —á–∞—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –æ—á–∏—Å—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1 —á–∞—Å).
*   `maxHistoryEntries` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ *—Å–æ–æ–±—â–µ–Ω–∏–π* (–Ω–µ –ø–∞—Ä) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ –æ–¥–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 40). –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è.
*   `maxToolCalls` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–∑–∞–ø—Ä–æ—Å -> –≤—ã–∑–æ–≤ -> —Ä–µ–∑—É–ª—å—Ç–∞—Ç -> –∑–∞–ø—Ä–æ—Å) –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `client.chat()` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10). –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã.
*   `security` (SecurityConfig, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –û–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥—É–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.** (–°–º. [–ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#-–º–æ–¥—É–ª—å-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏-securitymanager)).
*   `proxy` (string | object, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ù–∞—Å—Ç—Ä–æ–π–∫–∏ HTTP/HTTPS –ø—Ä–æ–∫—Å–∏. –õ–∏–±–æ URL —Å—Ç—Ä–æ–∫–∞ (`'http://user:pass@host:port'`), –ª–∏–±–æ –æ–±—ä–µ–∫—Ç (`{ host: string, port: number | string, user?: string, pass?: string }`).
*   `apiEndpoint` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π URL API OpenRouter –¥–ª—è —á–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `'https://openrouter.ai/api/v1/chat/completions'`).
*   `referer` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ó–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `HTTP-Referer` –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API (–¥–ª—è –≤–∞—à–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ OpenRouter).
*   `title` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ó–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Title` –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API (–¥–ª—è –≤–∞—à–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ OpenRouter).
*   `modelFallbacks` (string[], –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –°–ø–∏—Å–æ–∫ ID —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø—Ä–æ–±–æ–≤–∞–Ω—ã –ø–æ –ø–æ—Ä—è–¥–∫—É, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥–µ–ª–∏ (`config.model` –∏–ª–∏ `options.model`) –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –æ—à–∏–±–∫–æ–π.
*   `responseFormat` (ResponseFormat, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{ type: 'json_object' }`). –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ `client.chat()`.
*   `strictJsonParsing` (boolean, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ï—Å–ª–∏ `true`, –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ JSON (`responseFormat`) –∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON –±—É–¥–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω–∞ –æ—à–∏–±–∫–∞ `ValidationError`. –ï—Å–ª–∏ `false` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –≤ –ø–æ–ª–µ `content` —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±—É–¥–µ—Ç `null`.
*   `axiosConfig` (AxiosRequestConfig, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –Ω–∞–ø—Ä—è–º—É—é –≤ Axios (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Ç–∞–π–º–∞—É—Ç—ã, `httpsAgent`).
*   `enableCostTracking` (boolean, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤—ã–∑–æ–≤–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`). –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `/models` API.
*   `priceRefreshIntervalMs` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ò–Ω—Ç–µ—Ä–≤–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞ —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 6 —á–∞—Å–æ–≤).
*   `initialModelPrices` (Record<string, ModelPricingInfo>, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –º–æ–¥–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ –∫—ç—à–∞), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ `/models` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

*   `chat(options: OpenRouterRequestOptions): Promise<ChatCompletionResult>`: –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –º–æ–¥–µ–ª–∏. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Å—Ç–æ—Ä–∏–µ–π (–µ—Å–ª–∏ `options.user` —É–∫–∞–∑–∞–Ω) –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–µ—Å–ª–∏ `options.tools` —É–∫–∞–∑–∞–Ω—ã).
    *   `options`: –û–±—ä–µ–∫—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞ (—Å–º. `OpenRouterRequestOptions` –≤ `types/index.ts`). –ö–ª—é—á–µ–≤—ã–µ: `prompt` –∏–ª–∏ `customMessages`, `user?`, `tools?`, `model?`, `systemPrompt?`, `accessToken?`, `maxToolCalls?`, `responseFormat?`, `temperature?`, `maxTokens?` –∏ –¥—Ä.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Promise<ChatCompletionResult>` - –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏:
        *   `content`: –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ (—Å—Ç—Ä–æ–∫–∞, –æ–±—ä–µ–∫—Ç JSON –∏–ª–∏ `null` –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON).
        *   `usage`: –°—É–º–º–∞—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞ –≤–µ—Å—å —Ü–∏–∫–ª `chat()` (–≤–∫–ª—é—á–∞—è –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤): `{ prompt_tokens, completion_tokens, total_tokens }` –∏–ª–∏ `null`.
        *   `model`: ID –º–æ–¥–µ–ª–∏, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤—à–µ–π *—Ñ–∏–Ω–∞–ª—å–Ω—ã–π* –æ—Ç–≤–µ—Ç.
        *   `toolCallsCount`: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ *—É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö* –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–≥–æ `chat()`.
        *   `finishReason`: –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ *—Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ* –æ—Ç–≤–µ—Ç–∞ (`'stop'`, `'length'`, `'tool_calls'`, `'content_filter'`, `null`).
        *   `durationMs`: –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞ `chat()` –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö.
        *   `id`: ID *–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ* –∑–∞–ø—Ä–æ—Å–∞ –∫ API OpenRouter.
        *   `cost`: –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (USD) –≤—Å–µ–≥–æ –≤—ã–∑–æ–≤–∞ `chat()` –∏–ª–∏ `null`, –µ—Å–ª–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ (`enableCostTracking: false`) –∏–ª–∏ —Ü–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã.
*   `setModel(model: string)`: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤ `chat()`.
*   `setApiKey(apiKey: string)`: –û–±–Ω–æ–≤–ª—è–µ—Ç API –∫–ª—é—á, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤.
*   `createAccessToken(userInfo: Omit<UserAuthInfo, 'expiresAt'>, expiresIn?: string | number): string`: –°–æ–∑–¥–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞. –¢—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã `SecurityManager` –±—ã–ª —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è JWT (`userAuthentication.type: 'jwt'` –∏ `jwtSecret` –∑–∞–¥–∞–Ω).
*   `getCreditBalance(): Promise<CreditBalance>`: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤ OpenRouter –¥–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ API –∫–ª—é—á–∞. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ limit: number, usage: number }`.
*   `getModelPrices(): Record<string, ModelPricingInfo>`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏ –º–æ–¥–µ–ª–µ–π (`{ promptCostPerMillion, completionCostPerMillion, ... }`). –ê–∫—Ç—É–∞–ª—å–Ω–æ, –µ—Å–ª–∏ `enableCostTracking: true`.
*   `refreshModelPrices(): Promise<void>`: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π –∏–∑ API OpenRouter. –ê–∫—Ç—É–∞–ª—å–Ω–æ, –µ—Å–ª–∏ `enableCostTracking: true`.
*   `on(event: string, handler: (payload: any) => void)`: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è.
    *   `'error'`: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (payload: `OpenRouterError`).
    *   –°–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–µ—Å–ª–∏ `SecurityManager` –≤–∫–ª—é—á–µ–Ω): `'access:denied'`, `'ratelimit:exceeded'`, `'security:dangerous_args'`, `'token:invalid'`, `'user:authenticated'`, `'tool:call'` –∏ –¥—Ä. (—Å–º. `SecurityManager`).
*   `off(event: string, handler: (payload: any) => void)`: –û—Ç–ø–∏—Å–∫–∞ –æ—Ç —Å–æ–±—ã—Ç–∏–π.
*   `getHistoryManager(): UnifiedHistoryManager | undefined`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è).
*   `getSecurityManager(): SecurityManager | null`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–µ—Å–ª–∏ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω).
*   `getCostTracker(): CostTracker | null`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä —Ç—Ä–µ–∫–µ—Ä–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω).
*   `isDebugMode(): boolean`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∫–ª—é—á–µ–Ω –ª–∏ —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏.
*   `use(plugin: OpenRouterPlugin): Promise<void>`: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞.
*   `useMiddleware(fn: MiddlewareFunction): void`: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è middleware-—Ñ—É–Ω–∫—Ü–∏–∏.
*   `destroy(): Promise<void>`: **–í–ê–ñ–ù–û!** –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–º (–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä—ã –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω, –æ—á–∏—â–∞–µ—Ç –∫—ç—à–∏, —É–¥–∞–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `process.exit` –µ—Å–ª–∏ –±—ã–ª–∏). **–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–æ–º**, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –∏–ª–∏ —Ç–µ—Å—Ç–∞—Ö, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –∏ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

### üß© –ü–ª–∞–≥–∏–Ω—ã –∏ Middleware

–ü–ª–∞–≥–∏–Ω—ã –∏ middleware –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –º–æ—â–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ `OpenRouterClient`.

**–ü–ª–∞–≥–∏–Ω—ã (`client.use(plugin)`):**

*   –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–∂–Ω—É—é –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.
*   –ü–ª–∞–≥–∏–Ω - —ç—Ç–æ –æ–±—ä–µ–∫—Ç —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –º–µ—Ç–æ–¥–æ–º `init(client: OpenRouterClient)`.
*   –í–Ω—É—Ç—Ä–∏ `init` –ø–ª–∞–≥–∏–Ω –º–æ–∂–µ—Ç:
    *   –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å middleware (`client.useMiddleware(...)`).
    *   –ü–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (`client.on(...)`).
    *   –ó–∞–º–µ–Ω—è—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã (–∏—Å—Ç–æ—Ä–∏–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Å—Ç–æ–∏–º–æ—Å—Ç–∏) –Ω–∞ —Å–≤–æ–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è `client.setHistoryManager(...)`, `client.setSecurityManager(...)`, `client.setCostTracker(...)`. *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —ç—Ç–∏ —Å–µ—Ç—Ç–µ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø—É–±–ª–∏—á–Ω—ã–º–∏ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `client['propertyName'] = ...` –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ API.*
    *   –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –∏–ª–∏ —Å–≤–æ–π—Å—Ç–≤–∞ –∫ —ç–∫–∑–µ–º–ø–ª—è—Ä—É –∫–ª–∏–µ–Ω—Ç–∞ (`client.myCustomMethod = ...`).
*   **–ü—Ä–∏–º–µ—Ä—ã:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤.

**–ì–æ—Ç–æ–≤—ã–µ –ø–ª–∞–≥–∏–Ω—ã (–≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `plugins/`):**

*   `createRedisHistoryPlugin(redisUrl, prefix?)`: –ó–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ `UnifiedHistoryManager` —Å –∞–¥–∞–ø—Ç–µ—Ä–æ–º –¥–ª—è Redis. –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `ioredis`.
    ```typescript
    import { createRedisHistoryPlugin } from 'openrouter-kit/plugins';
    // const { createRedisHistoryPlugin } = require('openrouter-kit/plugins'); // CommonJS
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: npm install ioredis
    await client.use(createRedisHistoryPlugin('redis://localhost:6379'));
    ```
*   –î—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (`ExternalSecurity`, `BillingCostTracker`, `LoggingMiddleware`, `CustomToolRegistry`) —Å–ª—É–∂–∞—Ç –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∞—à–∏—Ö —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö.

**Middleware (`client.useMiddleware(fn)`):**

*   –§—É–Ω–∫—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–µ—Å—è –¥–æ –∏/–∏–ª–∏ –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ API –≤–Ω—É—Ç—Ä–∏ `client.chat()`.
*   –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω `async (ctx, next) => { ... await next(); ... }`.
*   `ctx` (MiddlewareContext): –û–±—ä–µ–∫—Ç —Å `request` (–≤—Ö–æ–¥—è—â–∏–µ –æ–ø—Ü–∏–∏) –∏ `response` (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫–∞). Middleware –º–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ –ø–æ–ª—è.
*   `next`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–∑–æ–≤–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ middleware –∏–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `chat`.
*   **–ü—Ä–∏–º–µ—Ä—ã:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤, –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–ø—Ü–∏–π –∑–∞–ø—Ä–æ—Å–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏), –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—é–¥–∂–µ—Ç–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º, –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π.

**–ü—Ä–∏–º–µ—Ä Middleware –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞:**

```typescript
client.useMiddleware(async (ctx, next) => {
  const MAX_COST_PER_CALL = 0.01; // –ú–∞–∫—Å–∏–º—É–º $0.01 –∑–∞ –≤—ã–∑–æ–≤
  const costTracker = client.getCostTracker();
  const model = ctx.request.options.model || client.model; // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–¥–µ–ª—å

  if (costTracker) {
    // –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ *–¥–æ* –≤—ã–∑–æ–≤–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω–æ–π –±–µ–∑ –∑–Ω–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤)
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞ –∏–ª–∏ –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    console.log(`[Middleware Cost Check] –í—ã–∑–æ–≤ –∫ –º–æ–¥–µ–ª–∏ ${model}.`);
  }

  await next(); // –í—ã–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å –∏ –¥—Ä—É–≥–∏–µ middleware

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å *–ø–æ—Å–ª–µ* –≤—ã–∑–æ–≤–∞
  if (ctx.response?.result?.cost && ctx.response.result.cost > MAX_COST_PER_CALL) {
    console.warn(`[Middleware Cost Alert] –°—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–∑–æ–≤–∞ (${ctx.response.result.cost.toFixed(6)}$) –ø—Ä–µ–≤—ã—Å–∏–ª–∞ –ª–∏–º–∏—Ç ${MAX_COST_PER_CALL}$`);
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  }
});
```

### üìú –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π (–ê–¥–∞–ø—Ç–µ—Ä—ã)

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `UnifiedHistoryManager` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IHistoryStorage` (–∞–¥–∞–ø—Ç–µ—Ä–∞). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏.

*   **–ê–¥–∞–ø—Ç–µ—Ä (`IHistoryStorage`):** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –º–µ—Ç–æ–¥—ã `load`, `save`, `delete`, `listKeys`.
*   **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã:**
    *   `MemoryHistoryStorage`: –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –≤ –ø–∞–º—è—Ç–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é). –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –î–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ.
    *   `DiskHistoryStorage`: –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –≤ JSON-—Ñ–∞–π–ª–∞—Ö –Ω–∞ –¥–∏—Å–∫–µ. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `chatsFolder` –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∫–ª–∏–µ–Ω—Ç–∞. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.
*   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
    *   `historyAdapter`: –ü–µ—Ä–µ–¥–∞–π—Ç–µ —ç–∫–∑–µ–º–ø–ª—è—Ä –≤–∞—à–µ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `new DiskHistoryStorage('./data/chats')`) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `historyStorage: 'disk'` –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –¥–∏—Å–∫–æ–≤–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞.
    *   `maxHistoryEntries`, `historyTtl`, `historyCleanupInterval`, `historyAutoSave` –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏.
*   **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `user` (–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `group`) –≤ `client.chat()`. –ú–µ–Ω–µ–¥–∂–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –∫–ª—é—á–∞, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–∑ `user` –∏ `group`.
*   **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã:** –í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `IHistoryStorage` –¥–ª—è –ª—é–±–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–ë–î, Redis, –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ). –ü—Ä–∏–º–µ—Ä - `RedisHistoryStorage` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `createRedisHistoryPlugin`).

**–ü—Ä–∏–º–µ—Ä —Å Disk Storage:**

```typescript
import OpenRouter from 'openrouter-kit';
import { DiskHistoryStorage } from 'openrouter-kit/history'; // –ò–º–ø–æ—Ä—Ç –∞–¥–∞–ø—Ç–µ—Ä–∞

const client = new OpenRouter({
  apiKey: 'YOUR_KEY',
  historyAdapter: new DiskHistoryStorage('./.my-chat-history'), // –£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–ø–∫—É
  maxHistoryEntries: 50, // –•—Ä–∞–Ω–∏—Ç—å –±–æ–ª—å—à–µ —Å–æ–æ–±—â–µ–Ω–∏–π
  historyAutoSave: true, // –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
});

// –î–∞–ª—å–Ω–µ–π—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ client.chat({ user: '...', prompt: '...' })
// –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ –ø–∞–ø–∫—É ./.my-chat-history
```

### üõ†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Function Calling)

–ü–æ–∑–≤–æ–ª—è–µ—Ç LLM –≤—ã–∑—ã–≤–∞—Ç—å –≤–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π.

1.  **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (`Tool`):**
    *   `type: 'function'` (–ø–æ–∫–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∏–ø).
    *   `function`: –û–±—ä–µ–∫—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –¥–ª—è LLM:
        *   `name` (string): –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏.
        *   `description` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è (–≤–∞–∂–Ω–æ –¥–ª—è LLM).
        *   `parameters` (object, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): JSON Schema, –æ–ø–∏—Å—ã–≤–∞—é—â–∞—è –æ–∂–∏–¥–∞–µ–º—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
    *   `execute: (args: any, context?: ToolContext) => Promise<any> | any`: **–í–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è**, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞. –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –∏ –ø—Ä–æ–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã (`args`) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (`context`), —Å–æ–¥–µ—Ä–∂–∞—â–∏–π `userInfo` (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω) –∏ `securityManager`. –î–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω –≤ JSON –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞—Ç–Ω–æ LLM.
    *   `security` (ToolSecurity, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `requiredRole`, `rateLimit`).

2.  **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `chat()`:**
    *   –ü–µ—Ä–µ–¥–∞–π—Ç–µ –º–∞—Å—Å–∏–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ `options.tools`.
    *   –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
        *   –û—Ç–ø—Ä–∞–≤–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –º–æ–¥–µ–ª–∏.
        *   –ï—Å–ª–∏ –º–æ–¥–µ–ª—å —Ä–µ—à–∏—Ç –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (`finish_reason: 'tool_calls'`), –±–∏–±–ª–∏–æ—Ç–µ–∫–∞:
            *   –†–∞—Å–ø–∞—Ä—Å–∏—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏ (`ToolCall.function.arguments`).
            *   –ü—Ä–æ–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–æ JSON Schema (`Tool.function.parameters`).
            *   **–í—ã–ø–æ–ª–Ω–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (`SecurityManager`, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω): –¥–æ—Å—Ç—É–ø (ACL), –ª–∏–º–∏—Ç—ã (Rate Limit), —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
            *   –í—ã–∑–æ–≤–µ—Ç –≤–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é `execute(args, context)`.
            *   –û—Ç–ø—Ä–∞–≤–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∏–ª–∏ –æ—à–∏–±–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è) –æ–±—Ä–∞—Ç–Ω–æ –º–æ–¥–µ–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ —Å `role: 'tool'`.
            *   –ü–æ–ª—É—á–∏—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏ (—Å `role: 'assistant'`).
    *   `options.maxToolCalls`: –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–∫–∏—Ö —Ü–∏–∫–ª–æ–≤ "–∑–∞–ø—Ä–æ—Å-–≤—ã–∑–æ–≤-—Ä–µ–∑—É–ª—å—Ç–∞—Ç".
    *   `options.toolChoice`: –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏–ª–∏ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –∏—Ö –≤—ã–∑–æ–≤ (`'none'`, `'auto'`, `{ type: "function", function: { name: "my_func" } }`).

3.  **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ –±—É–¥–µ—Ç –≤ `ChatCompletionResult.content`. `ChatCompletionResult.toolCallsCount` –ø–æ–∫–∞–∂–µ—Ç, —Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –±—ã–ª–æ –≤—ã–∑–≤–∞–Ω–æ.

### üîí –ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (`SecurityManager`)

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –∑–∞—â–∏—Ç—É –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏. –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–µ–π –æ–±—ä–µ–∫—Ç–∞ `security: SecurityConfig` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

*   `AuthManager`: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (JWT –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
*   `AccessControlManager`: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º (ACL).
*   `RateLimitManager`: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ –≤—ã–∑–æ–≤–æ–≤.
*   `ArgumentSanitizer`: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ–ø–∞—Å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`SecurityConfig`):**

*   `defaultPolicy` (`'deny-all'` | `'allow-all'`): –î–æ—Å—Ç—É–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º, –µ—Å–ª–∏ –Ω–µ—Ç —è–≤–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `'deny-all'`.
*   `requireAuthentication` (boolean): –ï—Å–ª–∏ `true`, –¥–ª—è –≤—ã–∑–æ–≤–∞ *–ª—é–±–æ–≥–æ* –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–π `accessToken`.
*   `allowUnauthenticatedAccess` (boolean): –ï—Å–ª–∏ `true` –∏ `requireAuthentication: false`, —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, —è–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –±–µ–∑ `accessToken`.
*   `userAuthentication` (`UserAuthConfig`): –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
    *   `type`: `'jwt'`, `'api-key'`, `'custom'`.
    *   `jwtSecret`: **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –¥–ª—è `type: 'jwt'`. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π —Å–µ–∫—Ä–µ—Ç –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ production!**
    *   `customAuthenticator`: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤/–∫–ª—é—á–µ–π.
*   `toolAccess` (`Record<string, ToolAccessConfig>`): –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ –µ–≥–æ –∏–º–µ–Ω–∏ (–∏–ª–∏ `*` –¥–ª—è –≤—Å–µ—Ö).
    *   `allow` (boolean): –Ø–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å/–∑–∞–ø—Ä–µ—Ç–∏—Ç—å.
    *   `roles` (string | string[]): –†–æ–ª–∏, –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–æ—Å—Ç—É–ø.
    *   `scopes` (string | string[]): –†–∞–∑—Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–æ—Å—Ç—É–ø.
    *   `rateLimit` (`RateLimit`): –õ–∏–º–∏—Ç –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–∏–º–∏—Ç—ã —Ä–æ–ª–∏).
    *   `allowedApiKeys` (string[]): –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ API-–∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–æ—Å—Ç—É–ø.
*   `roles` (`RolesConfig`): –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π.
    *   `roles`: –û–±—ä–µ–∫—Ç, –≥–¥–µ –∫–ª—é—á - –∏–º—è —Ä–æ–ª–∏, –∑–Ω–∞—á–µ–Ω–∏–µ - `RoleConfig`:
        *   `allowedTools` (string | string[]): –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–æ–ª–∏ (`*` –¥–ª—è –≤—Å–µ—Ö).
        *   `rateLimits` (`Record<string, RateLimit>`): –õ–∏–º–∏—Ç—ã –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è —ç—Ç–æ–π —Ä–æ–ª–∏ (–∫–ª—é—á - –∏–º—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏–ª–∏ `*`).
*   `dangerousArguments` (`DangerousArgumentsConfig`): –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
    *   `globalPatterns`, `toolSpecificPatterns`, `extendablePatterns` (RegExp[] | string[]): –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.
    *   `blockedValues` (string[]): –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏.
    *   `auditOnlyMode` (boolean): –ï—Å–ª–∏ `true`, –æ–ø–∞—Å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω—ã, –Ω–æ –≤—ã–∑–æ–≤ –Ω–µ –±—É–¥–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

1.  –°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ `SecurityManager`, –ø–µ—Ä–µ–¥–∞–≤ `security: securityConfig` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞.
2.  –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `client.chat()` –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `accessToken: 'your_jwt_token'` –≤ –æ–ø—Ü–∏—è—Ö, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.
3.  `SecurityManager` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `execute` –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞. –ü—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –±—É–¥–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –æ—à–∏–±–∫–∞ (`AuthorizationError`, `AccessDeniedError`, `RateLimitError`, `SecurityError`).
4.  –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `client.createAccessToken(userInfo, expiresIn?)` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JWT.
5.  –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (`access:denied`, `ratelimit:exceeded` –∏ —Ç.–¥.) —á–µ—Ä–µ–∑ `client.on(...)` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

### üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (Cost Tracking)

–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API OpenRouter.

**–í–∫–ª—é—á–µ–Ω–∏–µ:** `enableCostTracking: true` –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∫–ª–∏–µ–Ω—Ç–∞.

**–ú–µ—Ö–∞–Ω–∏–∑–º:**

1.  `CostTracker` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –∫–ª–∏–µ–Ω—Ç–æ–º.
2.  –û–Ω –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑ –≤ 6 —á–∞—Å–æ–≤, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `priceRefreshIntervalMs`) –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ü–µ–Ω—ã –º–æ–¥–µ–ª–µ–π —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `https://openrouter.ai/api/v1/models`.
3.  –¶–µ–Ω—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è. –ú–æ–∂–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ `initialModelPrices`.
4.  –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞ `chat()`, `CostTracker.calculateCost(model, usage)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–∫–µ–Ω–æ–≤ (`usage`) –∏ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ü–µ–Ω.
5.  –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `ChatCompletionResult.cost`.

**–ú–µ—Ç–æ–¥—ã –∫–ª–∏–µ–Ω—Ç–∞:**

*   `getCreditBalance(): Promise<CreditBalance>`: –ü–æ–ª—É—á–∏—Ç—å –ª–∏–º–∏—Ç –∏ —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤.
*   `getModelPrices(): Record<string, ModelPricingInfo>`: –ü–æ–ª—É—á–∏—Ç—å –∫—ç—à —Ü–µ–Ω.
*   `refreshModelPrices(): Promise<void>`: –û–±–Ω–æ–≤–∏—Ç—å –∫—ç—à —Ü–µ–Ω –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ.
*   `getCostTracker(): CostTracker | null`: –ü–æ–ª—É—á–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä —Ç—Ä–µ–∫–µ—Ä–∞.

**–¢–æ—á–Ω–æ—Å—Ç—å:** –†–∞—Å—á–µ—Ç —è–≤–ª—è–µ—Ç—Å—è **–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–º**, —Ç–∞–∫ –∫–∞–∫ —Ç–æ—á–Ω—ã–µ —Ü–µ–Ω—ã –∏ —Å–ø–æ—Å–æ–± –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ OpenRouter.

### ‚öôÔ∏è –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (`responseFormat`)

–ü—Ä–∏–Ω—É–∂–¥–∞–µ—Ç –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∫–ª–∏–µ–Ω—Ç–∞ (–¥–ª—è –æ—Ç–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), —Ç–∞–∫ –∏ –≤ –æ–ø—Ü–∏—è—Ö `client.chat()` (–¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞).

*   `{ type: 'json_object' }`: –¢—Ä–µ–±—É–µ—Ç –ª—é–±–æ–π –≤–∞–ª–∏–¥–Ω—ã–π JSON –æ–±—ä–µ–∫—Ç.
*   `{ type: 'json_schema', json_schema: { name: 'MySchema', schema: { ... } } }`: –¢—Ä–µ–±—É–µ—Ç JSON, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π JSON Schema. `name` - –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è —Å—Ö–µ–º—ã, `schema` - —Å–∞–º –æ–±—ä–µ–∫—Ç JSON Schema.

**–í–∞–∂–Ω–æ:**
*   –ù–µ –≤—Å–µ –º–æ–¥–µ–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç `responseFormat`.
*   –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `responseFormat`, –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ JSON. –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –≤ —Ç–æ–º –∂–µ –≤—ã–∑–æ–≤–µ.
*   **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞:**
    *   –ï—Å–ª–∏ `strictJsonParsing: false` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –ü—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º JSON –∏–ª–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å—Ö–µ–º–µ, `ChatCompletionResult.content` –±—É–¥–µ—Ç `null`.
    *   –ï—Å–ª–∏ `strictJsonParsing: true`: –ë—É–¥–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω–∞ –æ—à–∏–±–∫–∞ `ValidationError`.

### ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ—à–∏–±–æ–∫, –Ω–∞—Å–ª–µ–¥—É–µ–º—ã—Ö –æ—Ç `OpenRouterError`.

*   **`OpenRouterError`**: –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å. –°–æ–¥–µ—Ä–∂–∏—Ç `message`, `code` (–∏–∑ `ErrorCode`), `statusCode?`, `details?`.
*   **–ü–æ–¥–∫–ª–∞—Å—Å—ã:** `APIError`, `ValidationError`, `NetworkError`, `AuthenticationError`, `AuthorizationError`, `AccessDeniedError`, `ToolError`, `RateLimitError`, `TimeoutError`, `ConfigError`, `SecurityError`.
*   **`ErrorCode` (enum):** –°—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–æ–¥—ã –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ErrorCode.RATE_LIMIT_ERROR`, `ErrorCode.DANGEROUS_ARGS`).
*   **`mapError(error: any)`:** –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è (—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è) –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ Axios –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö `Error` –≤ `OpenRouterError`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

*   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `try...catch` –≤–æ–∫—Ä—É–≥ –≤—ã–∑–æ–≤–æ–≤ `client.chat()` –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤.
*   –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∏–ø –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `instanceof` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `error instanceof RateLimitError`) –∏–ª–∏ `error.code` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `error.code === ErrorCode.VALIDATION_ERROR`).
*   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `error.statusCode` –¥–ª—è HTTP —Å—Ç–∞—Ç—É—Å–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ).
*   –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `error.details` –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
*   –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏–µ `'error'` –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫: `client.on('error', (err) => console.error('Global Error:', err));`.

### üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

*   –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `Logger` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ –≤—Å–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ.
*   –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ñ–ª–∞–≥–æ–º `debug: true` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞.
*   –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `[SecurityManager]`, `[CostTracker]`) –¥–ª—è –ª–µ–≥–∫–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
*   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `console.log`, `console.debug`, `console.warn`, `console.error`.

### üåê –ü—Ä–æ–∫—Å–∏

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTP/HTTPS –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ –ø–æ–ª–µ `proxy` –≤ `OpenRouterConfig`:

```typescript
// URL —Å—Ç—Ä–æ–∫–∞
const client1 = new OpenRouter({
  apiKey: 'YOUR_KEY',
  proxy: 'http://user:pass@your-proxy.com:8080'
});

// –û–±—ä–µ–∫—Ç
const client2 = new OpenRouter({
  apiKey: 'YOUR_KEY',
  proxy: {
      host: 'proxy.example.com',
      port: 8888, // –ú–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º –∏–ª–∏ —Å—Ç—Ä–æ–∫–æ–π
      user: 'optional_user', // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
      pass: 'optional_pass' // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  }
});
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

[MIT](./LICENSE)