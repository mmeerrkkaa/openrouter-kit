# OpenRouter Kit

[![npm version](https://badge.fury.io/js/openrouter-kit.svg)](https://badge.fury.io/js/openrouter-kit) [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT) [![TypeScript](https://img.shields.io/badge/%3C/%3E-TypeScript-%230074C1.svg)](http://www.typescriptlang.org/)

**üá∑üá∫ –†—É—Å—Å–∫–∏–π** | [üá¨üáß English](./README.md)
---

**OpenRouter Kit** ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è –∏ —É–¥–æ–±–Ω–∞—è TypeScript/JavaScript –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å [OpenRouter API](https://openrouter.ai/). –û–Ω–∞ —É–ø—Ä–æ—â–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ LLM, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (function calling), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞–¥–µ–∂–Ω—ã–π –º–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤.

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **ü§ñ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —á–∞—Ç:** –ü—Ä–æ—Å—Ç–æ–π API (`client.chat`) –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ª—é–±–æ–π –º–æ–¥–µ–ª—å—é, –¥–æ—Å—Ç—É–ø–Ω–æ–π —á–µ—Ä–µ–∑ OpenRouter.
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `ChatCompletionResult` —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (`content`), –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö (`usage`), –º–æ–¥–µ–ª—å—é (`model`), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`toolCallsCount`), –ø—Ä–∏—á–∏–Ω–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (`finishReason`), –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (`durationMs`), ID –∑–∞–ø—Ä–æ—Å–∞ (`id`) –∏ **—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é** (`cost`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
*   **üìú –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±—Ä–µ–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –≥—Ä—É–ø–ø—ã.
    *   –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ –±–∞–∑–µ **–∞–¥–∞–ø—Ç–µ—Ä–æ–≤** (`IHistoryStorage`).
    *   –í –∫–æ–º–ø–ª–µ–∫—Ç–µ ‚Äî –∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –ø–∞–º—è—Ç–∏ –∏ –¥–∏—Å–∫–∞ (JSON-—Ñ–∞–π–ª—ã).
    *   –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å —Å–≤–æ–∏ –∞–¥–∞–ø—Ç–µ—Ä—ã (Redis, Mongo, API –∏ –¥—Ä.).
*   **üõ†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Function Calling):** –ë–µ—Å—à–æ–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ –≤–∞—à–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –º–æ–¥–µ–ª—å—é.
    *   –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å JSON Schema –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã –∏ **–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
    *   –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–∞—à–∏—Ö `execute` —Ñ—É–Ω–∫—Ü–∏–π —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–≤–∫–ª—é—á–∞—è `userInfo`).
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
    *   –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ª–∏–º–∏—Ç –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`maxToolCalls`) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è.
*   **üõ°Ô∏è –ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è –≤–∞—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
    *   **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ JWT (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ). –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤.
    *   **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ (ACL):** –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π, API-–∫–ª—é—á–µ–π, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (scopes) –∏–ª–∏ —è–≤–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª (`allow`/`deny`).
    *   **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã (Rate Limiting):** –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ —Ä–æ–ª–µ–π.
    *   **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (SQLi, XSS, command injection –∏ —Ç.–¥.) —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Ä–µ–∂–∏–º–∞ –∞—É–¥–∏—Ç–∞.
    *   **–°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π:** –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (`access:denied`, `ratelimit:exceeded`, `security:dangerous_args` –∏ –¥—Ä.) –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
*   **üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (Cost Tracking):** (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞ `chat` –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö –∏ —Ü–µ–Ω–∞—Ö –º–æ–¥–µ–ª–µ–π OpenRouter.
    *   –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π –∏–∑ API OpenRouter.
    *   –ú–µ—Ç–æ–¥ `getCreditBalance()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤.
*   **‚öôÔ∏è –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–∞, –º–æ–¥–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, —Ç–∞–π–º–∞—É—Ç–æ–≤, **–ø—Ä–æ–∫—Å–∏**, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (`Referer`, `X-Title`), —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (`modelFallbacks`), —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞ (`responseFormat`), –ª–∏–º–∏—Ç–∞ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`maxToolCalls`), –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (`enableCostTracking`) –∏ –¥—Ä.
*   **üí° –¢–∏–ø–∏–∑–∞—Ü–∏—è:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ TypeScript, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤.
*   **üö¶ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –ü–æ–Ω—è—Ç–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ—à–∏–±–æ–∫ (`APIError`, `ValidationError`, `SecurityError`, `RateLimitError` –∏ —Ç.–¥.) —Å –∫–æ–¥–∞–º–∏ –∏ –¥–µ—Ç–∞–ª—è–º–∏.
*   **üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≥–∏–±–∫–∏–π –ª–æ–≥–≥–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –∏ —Ä–µ–∂–∏–º–∞ –æ—Ç–ª–∞–¥–∫–∏.
*   **‚ú® –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API, —Å–∫—Ä—ã–≤–∞—é—â–∏–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å LLM –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.
*   **üßπ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏:** –ú–µ—Ç–æ–¥ `destroy()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ (—Ç–∞–π–º–µ—Ä—ã, –∫—ç—à–∏, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏) –≤ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
*   **üß© –ü–ª–∞–≥–∏–Ω-—Å–∏—Å—Ç–µ–º–∞:** –†–∞—Å—à–∏—Ä—è–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–¥—Ä–∞.
    *   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ `client.use(plugin)`.
    *   –ü–ª–∞–≥–∏–Ω—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å middleware, –∑–∞–º–µ–Ω—è—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—ã, –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å API.
*   **üîó Middleware-—Ü–µ–ø–æ—á–∫–∞:** –ì–∏–±–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.
    *   –î–æ–±–∞–≤–ª—è–π—Ç–µ middleware-—Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ `client.useMiddleware(fn)`.
    *   Middleware –º–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –æ—Ç–≤–µ—Ç—ã, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—É–¥–∏—Ç, –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –¥—Ä.

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install openrouter-kit
# –∏–ª–∏
yarn add openrouter-kit
# –∏–ª–∏
pnpm add openrouter-kit
```

## ‚ú® –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**TypeScript:**

```typescript
import OpenRouter from 'openrouter-kit';

const client = new OpenRouter({
  apiKey: process.env.OPENROUTER_API_KEY || 'sk-or-v1-...',
  enableCostTracking: true, // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
});

async function main() {
  try {
    const result = await client.chat({ // –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç ChatCompletionResult
      prompt: '–ü–µ—Ä–µ–¥–∞–π –ø—Ä–∏–≤–µ—Ç!',
      model: 'google/gemini-2.0-flash-001', // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–¥–µ–ª—å
    });

    console.log('–û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏:', result.content); // –î–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É —á–µ—Ä–µ–∑ .content
    console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤:', result.usage);
    console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å:', result.model);
    console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:', result.toolCallsCount);
    console.log('–ü—Ä–∏—á–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:', result.finishReason);
    console.log('–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–º—Å):', result.durationMs);
    if (result.cost !== null) {
      console.log('–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (USD):', result.cost);
    }

    // –ü—Ä–∏–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
    const balance = await client.getCreditBalance();
    console.log(`–ë–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ $${balance.usage.toFixed(4)} –∏–∑ $${balance.limit.toFixed(2)}`);

  } catch (error: any) {
    console.error(`–û—à–∏–±–∫–∞: ${error.message}`, error.details || error);
  } finally {
    await client.destroy(); // –í–∞–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
  }
}

main();
```

**JavaScript (CommonJS):**

```javascript
const { OpenRouterClient } = require("openrouter-kit");

const client = new OpenRouterClient({
  apiKey: process.env.OPENROUTER_API_KEY || 'sk-or-v1-...',
  enableCostTracking: true, // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
});

async function main() {
  try {
    const result = await client.chat({ prompt: 'Hello, world!' });
    console.log('–û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏:', result.content);
    console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:', result.usage);
    console.log('–°—Ç–æ–∏–º–æ—Å—Ç—å:', result.cost);
  } catch (error) {
     console.error(`–û—à–∏–±–∫–∞: ${error.message}`, error.details || error);
  } finally {
     await client.destroy();
  }
}

main();
```

## –ë–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –ø—Ä–∏–º–µ—Ä (–¢–∞–∫—Å–∏-–±–æ—Ç)

```javascript
const { OpenRouterClient } = require("openrouter-kit");
const readline = require('readline');

// –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∫—Å–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
// const proxyConfig = {
//   host: "your.proxy.server",
//   port: 8080,
//   user: "proxy_user", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
//   pass: "proxy_pass", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
// };

const client = new OpenRouterClient({
  apiKey: process.env.OPENROUTER_API_KEY || "sk-or-v1-...",
  model: "google/gemini-2.0-flash-001", // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å
  historyStorage: "memory",
  // proxy: proxyConfig, // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–æ–∫—Å–∏
  enableCostTracking: true, // –í–∫–ª—é—á–∞–µ–º —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  // debug: true // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤
});

let orderAccepted = false; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø—Ä–∏–º–µ—Ä–∞

// --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ---
const taxiTools = [
  {
    type: "function",
    function: {
      name: "estimateRideCost",
      description: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏ –Ω–∞ —Ç–∞–∫—Å–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –∞–¥—Ä–µ—Å–∞–º–∏.",
      parameters: {
        type: "object",
        properties: {
          from: { type: "string", description: "–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è" },
          to: { type: "string", description: "–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è" }
        },
        required: ["from", "to"]
      },
    },
    // –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
    execute: async (args) => {
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç] –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ—Ç ${args.from} –¥–æ ${args.to}`);
      const cost = Math.floor(Math.random() * 900) + 100; // –°–∏–º—É–ª—è—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞
      return {
        from: args.from,
        to: args.to,
        estimatedCost: cost,
        currency: "RUB"
      };
    }
  },
  {
    type: "function",
    function: {
      name: "acceptOrder",
      description: "–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑ —Ç–∞–∫—Å–∏ –∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è.",
      parameters: {
        type: "object",
        properties: {
          from: { type: "string", description: "–ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è" },
          to: { type: "string", description: "–ê–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è" }
        },
        required: ["from", "to"]
      },
    },
    // –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
    execute: async (args) => {
      console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç] –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–∞ –æ—Ç ${args.from} –¥–æ ${args.to}`);
      const driverNumber = Math.floor(Math.random() * 100) + 1;
      orderAccepted = true; // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â—É—é –¥–µ–π—Å—Ç–≤–∏–µ
      return `–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç. –í–æ–¥–∏—Ç–µ–ª—å ${driverNumber} —É–∂–µ –≤ –ø—É—Ç–∏ –∫ –≤–∞–º –ø–æ –∞–¥—Ä–µ—Å—É ${args.from}. –ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${args.to}`;
    }
  }
];

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

function askQuestion(query) {
  return new Promise((resolve) => {
    rl.question(query, (answer) => {
      resolve(answer);
    });
  });
}

const systemPrompt = `–¢—ã ‚Äî –ø–æ–ª–µ–∑–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä —Å–ª—É–∂–±—ã —Ç–∞–∫—Å–∏. –¢–≤–æ—è —Ü–µ–ª—å ‚Äî –ø–æ–º–æ—á—å –∫–ª–∏–µ–Ω—Ç—É –∑–∞–∫–∞–∑–∞—Ç—å —Ç–∞–∫—Å–∏.
–¢—ã –º–æ–∂–µ—à—å –∑–∞–¥–∞–≤–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –∞–¥—Ä–µ—Å–∞.
–°–Ω–∞—á–∞–ª–∞ –æ—Ü–µ–Ω–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏ —Å –ø–æ–º–æ—â—å—é 'estimateRideCost'.
–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–π 'acceptOrder', —á—Ç–æ–±—ã –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–µ–∑–¥–∫—É.`;

async function chatWithTaxiBot() {
  const userId = "taxi_user_1";
  console.log("–ë–æ—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–ª—É–∂–±—É —Ç–∞–∫—Å–∏ OpenRouterKit. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?");

  try {
    while (!orderAccepted) {
      const userMessage = await askQuestion("–í—ã: ");
      if (userMessage.toLowerCase() === 'quit') break;

      const result = await client.chat({ // –ü–æ–ª—É—á–∞–µ–º ChatCompletionResult
        user: userId, // –í–∫–ª—é—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        prompt: userMessage,
        systemPrompt: systemPrompt,
        tools: taxiTools, // –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
        temperature: 0.6,
        maxToolCalls: 5 // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
      });

      console.log(`\n–ë–æ—Ç: ${result.content}\n`); // –î–æ—Å—Ç—É–ø –∫ –æ—Ç–≤–µ—Ç—É —á–µ—Ä–µ–∑ .content
      console.log(`[–û—Ç–ª–∞–¥–∫–∞] –ú–æ–¥–µ–ª—å: ${result.model}, –í—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: ${result.toolCallsCount}, –°—Ç–æ–∏–º–æ—Å—Ç—å: ${result.cost !== null ? '$' + result.cost.toFixed(6) : 'N/A'}`);

      if (orderAccepted) {
        console.log("–ë–æ—Ç: –í–∞—à –∑–∞–∫–∞–∑ —Ç–∞–∫—Å–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω. –ü—Ä–∏—è—Ç–Ω–æ–π –ø–æ–µ–∑–¥–∫–∏!");
      }
    }
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞:", error.message, error.details || error);
  } finally {
    rl.close();
    await client.destroy(); // –í–∞–∂–Ω–æ: –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã –∫–ª–∏–µ–Ω—Ç–∞
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
chatWithTaxiBot();
```

## üìö –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### `OpenRouterClient`

–≠—Ç–æ –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`OpenRouterConfig`)**:

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ `new OpenRouterClient(config)` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `config`. –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:

*   `apiKey` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): –í–∞—à API –∫–ª—é—á OpenRouter. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.**
*   `model` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Å–º. `config.ts`, –Ω–∞–ø—Ä–∏–º–µ—Ä, `google/gemini-flash-1.5`).
*   `debug` (boolean, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`).
*   `historyAdapter` (IHistoryStorage, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ö–∞—Å—Ç–æ–º–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ (–ø–∞–º—è—Ç—å, –¥–∏—Å–∫, Redis, API –∏ –¥—Ä.).
*   `historyAutoSave` (boolean, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–µ—Å–ª–∏ –∞–¥–∞–ø—Ç–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç).
*   `historyTtl` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –≤ –º—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 24 —á–∞—Å–∞).
*   `historyCleanupInterval` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –≤ –º—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1 —á–∞—Å).
*   `maxHistoryEntries` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ *—Å–æ–æ–±—â–µ–Ω–∏–π* (–Ω–µ –ø–∞—Ä) –≤ –∏—Å—Ç–æ—Ä–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 40).
*   `maxToolCalls` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞ –æ–¥–∏–Ω –≤—ã–∑–æ–≤ `chat()` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10).
*   `security` (SecurityConfig, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Å–º. –Ω–∏–∂–µ). **–í–∞–∂–Ω–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤!**
*   `proxy` (string | object, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ù–∞—Å—Ç—Ä–æ–π–∫–∏ HTTP/HTTPS –ø—Ä–æ–∫—Å–∏ (URL –∏–ª–∏ `{ host, port, user?, pass? }`).
*   `apiEndpoint` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): URL API OpenRouter –¥–ª—è —á–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `https://openrouter.ai/api/v1/chat/completions`).
*   `referer`, `title` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ó–∞–≥–æ–ª–æ–≤–∫–∏ `HTTP-Referer` –∏ `X-Title` (–¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ OpenRouter).
*   `modelFallbacks` (string[], –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –°–ø–∏—Å–æ–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–π.
*   `responseFormat` (ResponseFormat, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{ type: 'json_object' }`).
*   `strictJsonParsing` (boolean, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º –ø–∞—Ä—Å–∏–Ω–≥–∞/–≤–∞–ª–∏–¥–∞—Ü–∏–∏ JSON –≤ –æ—Ç–≤–µ—Ç–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`). –ï—Å–ª–∏ `true` - –æ—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º JSON, –µ—Å–ª–∏ `false` - –≤–µ—Ä–Ω–µ—Ç `null` –≤ –ø–æ–ª–µ `content`.
*   `axiosConfig` (AxiosRequestConfig, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Axios (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Ç–∞–π–º–∞—É—Ç—ã).
*   `enableCostTracking` (boolean, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤—ã–∑–æ–≤–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`).
*   `priceRefreshIntervalMs` (number, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π –≤ –º—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 6 —á–∞—Å–æ–≤).
*   `initialModelPrices` (Record<string, ModelPricingInfo>, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –º–æ–¥–µ–ª–µ–π, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ API.

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã**:

*   `chat(options: OpenRouterRequestOptions): Promise<ChatCompletionResult>`: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –º–æ–¥–µ–ª–∏. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏ –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    *   `options.prompt` (string): –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–ª–∏ `customMessages`).
    *   `options.customMessages` (Message[] | null): –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ `prompt`.
    *   `options.user` (string): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–µ–π.
    *   `options.tools` (Tool[]): –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
    *   `options.accessToken` (string): –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ JWT (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `SecurityManager`).
    *   `options.maxToolCalls` (number): –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–∏–º–∏—Ç –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
    *   ... –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã API (`model`, `systemPrompt`, `temperature`, `maxTokens`, `responseFormat` –∏ —Ç.–¥.).
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Promise<ChatCompletionResult>` - –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏:
        *   `content`: –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ (—Å—Ç—Ä–æ–∫–∞, –æ–±—ä–µ–∫—Ç –∏–ª–∏ `null`).
        *   `usage`: –°—É–º–º–∞—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (`{ prompt_tokens, completion_tokens, total_tokens }` –∏–ª–∏ `null`).
        *   `model`: ID –º–æ–¥–µ–ª–∏, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤—à–µ–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.
        *   `toolCallsCount`: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.
        *   `finishReason`: –ü—Ä–∏—á–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
        *   `durationMs`: –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `chat()` –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö.
        *   `id`: ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ API.
        *   `cost`: –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (USD) –∏–ª–∏ `null`, –µ—Å–ª–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ –∏–ª–∏ —Ü–µ–Ω—ã –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã.
*   `setModel(model: string)`: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
*   `setApiKey(apiKey: string)`: –û–±–Ω–æ–≤–ª—è–µ—Ç API –∫–ª—é—á.
*   `createAccessToken(userInfo, expiresIn?)`: –°–æ–∑–¥–∞–µ—Ç JWT (—Ç—Ä–µ–±—É–µ—Ç `SecurityManager` —Å JWT).
*   `getCreditBalance(): Promise<CreditBalance>`: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤ OpenRouter.
*   `getModelPrices(): Record<string, ModelPricingInfo>`: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã –º–æ–¥–µ–ª–µ–π.
*   `refreshModelPrices(): Promise<void>`: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫—ç—à —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π.
*   `on(event, handler)` / `off(event, handler)`: –ü–æ–¥–ø–∏—Å–∫–∞/–æ—Ç–ø–∏—Å–∫–∞ –æ—Ç —Å–æ–±—ã—Ç–∏–π (`'error'`, —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏).
*   `getHistoryManager()`: –î–æ—Å—Ç—É–ø –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É –∏—Å—Ç–æ—Ä–∏–∏.
*   `getSecurityManager()`: –î–æ—Å—Ç—É–ø –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
*   `getCostTracker()`: –î–æ—Å—Ç—É–ø –∫ —Ç—Ä–µ–∫–µ—Ä—É —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω).
*   `destroy(): Promise<void>`: **–í–ê–ñ–ù–û!** –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã (—Ç–∞–π–º–µ—Ä—ã, –∫—ç—à–∏, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏). **–í—ã–∑—ã–≤–∞–π—Ç–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–æ–º**, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤.

### üß© –ü–ª–∞–≥–∏–Ω—ã –∏ Middleware

**–ü–ª–∞–≥–∏–Ω—ã (`client.use(plugin)`):**

* –ü–æ–∑–≤–æ–ª—è—é—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–¥—Ä–∞.
* –ü–ª–∞–≥–∏–Ω ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç —Å –º–µ—Ç–æ–¥–æ–º `init(client)`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä `OpenRouterClient`.
* –í–Ω—É—Ç—Ä–∏ `init()` –ø–ª–∞–≥–∏–Ω –º–æ–∂–µ—Ç:
  * –î–æ–±–∞–≤–ª—è—Ç—å middleware (`client.useMiddleware`)
  * –ü–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è (`client.on`)
  * –ó–∞–º–µ–Ω—è—Ç—å –∏–ª–∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—ã (–∏—Å—Ç–æ—Ä–∏–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
  * –î–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ–∏ –º–µ—Ç–æ–¥—ã, —Å–≤–æ–π—Å—Ç–≤–∞, API
* –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–ª–∞–≥–∏–Ω–æ–≤, –ø–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞:**

```typescript
const myPlugin = {
  async init(client) {
    console.log('–ü–ª–∞–≥–∏–Ω –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
    client.useMiddleware(async (ctx, next) => {
      console.log('–ú–æ–π middleware: –∑–∞–ø—Ä–æ—Å', ctx.request.options);
      await next();
      console.log('–ú–æ–π middleware: –æ—Ç–≤–µ—Ç', ctx.response);
    });
  }
};

await client.use(myPlugin);
```

**Middleware (`client.useMiddleware(fn)`):**

* –ü–æ–∑–≤–æ–ª—è—é—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã.
* –ò—Å–ø–æ–ª—å–∑—É—é—Ç –∑–Ω–∞–∫–æ–º—É—é –º–æ–¥–µ–ª—å Express/Koa: `(ctx, next) => { ... }`
* –ú–æ–≥—É—Ç:
  * –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `ctx.request.options` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å `ctx.response` –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è
  * –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—É–¥–∏—Ç, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥—Ä.
* –í—ã–∑—ã–≤–∞—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`client.useMiddleware(fn)`).
* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ middleware —É–∂–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—ã–∑–æ–≤ `chat()`.

**–ü—Ä–∏–º–µ—Ä middleware –¥–ª—è –∞—É–¥–∏—Ç–∞:**

```typescript
client.useMiddleware(async (ctx, next) => {
  const start = Date.now();
  await next();
  const duration = Date.now() - start;
  console.log(`[AUDIT] –ó–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏ ${ctx.request.options.model} –∑–∞–Ω—è–ª ${duration} –º—Å`);
  if (ctx.response?.error) {
    console.warn(`[AUDIT] –û—à–∏–±–∫–∞: ${ctx.response.error.message}`);
  } else {
    console.log(`[AUDIT] –û—Ç–≤–µ—Ç:`, ctx.response?.result?.content);
  }
});
```

*Middleware –∏ –ø–ª–∞–≥–∏–Ω—ã ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ OpenRouter Kit.*

### üìú –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π (–∞–¥–∞–ø—Ç–µ—Ä—ã)

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –≤ `client.chat()` –ø–µ—Ä–µ–¥–∞–Ω `user` (–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `group`).

*   **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–º:** –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—Å–∏–≤ `messages`, –µ—Å–ª–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å (`customMessages`).
*   **–ì–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ò—Å—Ç–æ—Ä–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä `IHistoryStorage`.
*   **–í –∫–æ–º–ø–ª–µ–∫—Ç–µ:** –ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –ø–∞–º—è—Ç–∏ –∏ –¥–∏—Å–∫–∞ (JSON-—Ñ–∞–π–ª—ã).
*   **–ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å —Å–≤–æ–∏:** Redis, MongoDB, REST API –∏ –¥—Ä.
*   **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** TTL, –ª–∏–º–∏—Ç—ã, –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äî —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥ –∫–ª–∏–µ–Ω—Ç–∞.

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ (TypeScript):**

```typescript
import OpenRouter from 'openrouter-kit';

const client = new OpenRouter({ apiKey: 'YOUR_KEY', historyStorage: 'memory' });
const userId = 'user-xyz';

async function chatWithHistory(prompt: string) {
  console.log(`> User (${userId}): ${prompt}`);
  // –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–µ–º user ID, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–¥–µ–ª–∞–µ—Ç —Å–∞–º–∞
  const result = await client.chat({ prompt, user: userId });
  console.log(`< Assistant: ${result.content}`); // –î–æ—Å—Ç—É–ø –∫ –æ—Ç–≤–µ—Ç—É —á–µ—Ä–µ–∑ .content
  return result.content;
}

async function runConversation() {
  await chatWithHistory('–ú–æ–π –ª—é–±–∏–º—ã–π —Ü–≤–µ—Ç - —Å–∏–Ω–∏–π.');
  await chatWithHistory('–ö–∞–∫–æ–π –º–æ–π –ª—é–±–∏–º—ã–π —Ü–≤–µ—Ç?'); // –ú–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –ø–æ–º–Ω–∏—Ç—å
  await client.destroy();
}

runConversation();
```

### üõ†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Function Calling)

–ü–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–µ–ª—è–º –≤—ã–∑—ã–≤–∞—Ç—å –≤–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–∏.

**1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (`Tool`)**:
–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å –ø–æ–º–æ—â—å—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `Tool`. **–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:** `type: 'function'`, `function.name`, `function.parameters` (JSON Schema) –∏ `execute` (–≤–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è).

```typescript
import { Tool, ToolContext } from 'openrouter-kit';

// –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
async function getUserData(userId: string): Promise<{ id: string; name: string; email: string } | null> {
  console.log(`[–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç] –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}`);
  // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
  if (userId === '123') {
    return { id: userId, name: 'Alice', email: 'alice@example.com' };
  }
  return null;
}

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
const getUserDataTool: Tool = {
  type: 'function',
  function: {
    name: 'getUserData',
    description: '–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ ID.',
    parameters: {
      type: 'object',
      properties: {
        userId: { type: 'string', description: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞.' },
      },
      required: ['userId'],
    },
  },
  // –í–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞
  execute: async (args: { userId: string }, context?: ToolContext) => {
    console.log(`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ getUserData –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º: ${context?.userInfo?.userId || 'unknown'}`);
    const userData = await getUserData(args.userId);
    if (!userData) {
      // –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—ä–µ–∫—Ç, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      return { error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
    }
    return userData; // –í–µ—Ä–Ω–µ—Ç { id: '123', name: 'Alice', email: 'alice@example.com' }
  },
  security: {
      // requiredRole: 'admin', // –ü—Ä–∏–º–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
  }
};
```

**2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ `chat()`**:
–ü–µ—Ä–µ–¥–∞–π—Ç–µ –º–∞—Å—Å–∏–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ `client.chat({ tools: [...] })`. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è –≤–µ—Å—å —Ü–∏–∫–ª: –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π -> –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–∑–æ–≤ -> –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ -> –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã -> –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -> –≤—ã–∑–æ–≤ `execute` -> –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -> –ø–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞. –í—ã –º–æ–∂–µ—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é `maxToolCalls`.

```typescript
// TypeScript Example
import OpenRouter from 'openrouter-kit';
// import { getUserDataTool } from './tools'; // –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –¥—Ä—É–≥–æ–º —Ñ–∞–π–ª–µ

async function findUser() {
  const client = new OpenRouter({ apiKey: 'YOUR_KEY' /*, security: securityConfig */ });
  try {
    const result = await client.chat({
      prompt: "–ü–æ–ª—É—á–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID 123.",
      tools: [getUserDataTool], // –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
      maxToolCalls: 3 // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 3 —Ä–∞—É–Ω–¥–∞–º–∏ –≤—ã–∑–æ–≤–æ–≤
    });
    console.log('–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:', result.content); // –Ω–∞–ø—Ä–∏–º–µ—Ä, "–î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 123: –ò–º—è: Alice, Email: alice@example.com."
    console.log('–í—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:', result.toolCallsCount);
  } catch (error: any) {
    console.error('–û—à–∏–±–∫–∞:', error.message);
  } finally {
    await client.destroy();
  }
}

findUser();
```

### üîí –ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (`SecurityManager`)

–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–µ–π –æ–±—ä–µ–∫—Ç–∞ `security: SecurityConfig` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `OpenRouterClient`. **–ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏**, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∫–∞–∫–∏–µ-–ª–∏–±–æ –¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º.

**–ö–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`SecurityConfig`):**

*   `defaultPolicy`: `'deny-all'` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –∏–ª–∏ `'allow-all'`. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º, –µ—Å–ª–∏ –Ω–µ—Ç —è–≤–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª.
*   `requireAuthentication`: `true` - —Ç—Ä–µ–±–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π `accessToken` –¥–ª—è –õ–Æ–ë–û–ì–û –∑–∞–ø—Ä–æ—Å–∞ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.
*   `allowUnauthenticatedAccess`: `true` - —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –±–µ–∑ `accessToken` (–µ—Å–ª–∏ `requireAuthentication: false` –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –∞–Ω–æ–Ω–∏–º–æ–≤).
*   `userAuthentication`: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{ type: 'jwt', jwtSecret: 'YOUR_STRONG_SECRET' }`). **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ production!**
*   `toolAccess`: –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (`allow`, `roles`, `scopes`, `rateLimit`, `allowedApiKeys`).
*   `roles`: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∏ –∏—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π/–ª–∏–º–∏—Ç–æ–≤.
*   `dangerousArguments`: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (`blockedValues`, `globalPatterns`, `toolSpecificPatterns`, `extendablePatterns`, `auditOnlyMode`).

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (TypeScript):**

```typescript
import OpenRouter from 'openrouter-kit';
import type { SecurityConfig } from 'openrouter-kit'; // –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç –¥–ª—è —Ç–∏–ø–∞

const jwtSecret = process.env.JWT_SECRET || 'very-secret-key-CHANGE-ME'; // –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ env var!

const securityConfig: SecurityConfig = {
  debug: process.env.NODE_ENV === 'development', // –õ–æ–≥–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
  defaultPolicy: 'deny-all',
  requireAuthentication: true, // –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

  userAuthentication: {
    type: 'jwt',
    jwtSecret: jwtSecret,
  },

  toolAccess: {
    // –†–∞–∑—Ä–µ—à–∏—Ç—å getCurrentWeather —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–æ–ª–∏ 'user', –ª–∏–º–∏—Ç 10/–º–∏–Ω
    'getCurrentWeather': {
      allow: true,
      roles: ['user'],
      rateLimit: { limit: 10, period: 'minute' }
    },
    // –†–∞–∑—Ä–µ—à–∏—Ç—å adminAction —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–æ–ª–∏ 'admin'
    'adminAction': {
      allow: true,
      roles: ['admin'],
    }
  },

  dangerousArguments: {
    auditOnlyMode: false, // –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∞—Å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
    extendablePatterns: [/custom_danger_pattern/i], // –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
  }
};

const client = new OpenRouter({
  apiKey: 'YOUR_KEY',
  security: securityConfig
});

// --- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ---

async function secureToolCall() {
  try {
    // 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    const userInfo = { userId: 'alice-456', role: 'user' };
    const accessToken = client.createAccessToken(userInfo, '1h'); // –°–æ–∑–¥–∞–µ–º JWT –Ω–∞ 1 —á–∞—Å

    // 2. –í—ã–∑–æ–≤ —á–∞—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º
    const result = await client.chat({ // –ü–æ–ª—É—á–∞–µ–º ChatCompletionResult
      prompt: '–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ü–∞—Ä–∏–∂–µ?',
      tools: [/* weatherTool - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≥–¥–µ-—Ç–æ –µ—â–µ */],
      accessToken: accessToken // –ü–µ—Ä–µ–¥–∞–µ–º —Ç–æ–∫–µ–Ω
    });
    console.log('–û—Ç–≤–µ—Ç:', result.content); // –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ .content

  } catch (e: any) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    console.error(`–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏/—á–∞—Ç–∞: ${e.message} (–ö–æ–¥: ${e.code})`, e.details);
  } finally {
    await client.destroy();
  }
}

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
client.on('access:denied', (event) => {
  console.warn(`[–°–æ–±—ã—Ç–∏–µ] –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${event.userId} –∫ ${event.toolName}. –ü—Ä–∏—á–∏–Ω–∞: ${event.reason}`);
});

secureToolCall();
```

### üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (Cost Tracking)

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞ `client.chat()` –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö –∏ —Ü–µ–Ω–∞—Ö –º–æ–¥–µ–ª–µ–π OpenRouter.

**–í–∫–ª—é—á–µ–Ω–∏–µ:**

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `enableCostTracking: true` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞:

```typescript
const client = new OpenRouter({
  apiKey: 'YOUR_KEY',
  enableCostTracking: true, // –í–∫–ª—é—á–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  // priceRefreshIntervalMs: 4 * 60 * 60 * 1000 // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ–±–Ω–æ–≤–ª—è—Ç—å —Ü–µ–Ω—ã –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6)
});
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1.  –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–∏–ª–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏) –∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –º–æ–¥–µ–ª–µ–π —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/models` OpenRouter API.
2.  –¶–µ–Ω—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏.
3.  –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `chat`, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ `usage` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤) –∏ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

–ï—Å–ª–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ, –æ–±—ä–µ–∫—Ç `ChatCompletionResult`, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –º–µ—Ç–æ–¥–æ–º `chat`, –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª–µ `cost` (—Ç–∏–ø `number | null`):

```typescript
const result = await client.chat({ prompt: '–ü—Ä–∏–≤–µ—Ç!' });

console.log('–ö–æ–Ω—Ç–µ–Ω—Ç:', result.content);
console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:', result.usage);
console.log('–ú–æ–¥–µ–ª—å:', result.model);
console.log('–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (USD):', result.cost); // <-- –ù–æ–≤–æ–µ –ø–æ–ª–µ
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤:**

–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º:

```typescript
try {
  const balance = await client.getCreditBalance();
  console.log(`–õ–∏–º–∏—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤: $${balance.limit.toFixed(2)}`);
  console.log(`–¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $${balance.usage.toFixed(2)}`);
  console.log(`–û—Å—Ç–∞–ª–æ—Å—å: $${(balance.limit - balance.usage).toFixed(2)}`);
} catch (error) {
  console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤:", error);
}
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ –º–æ–¥–µ–ª–µ–π:**

*   `client.getModelPrices(): Record<string, ModelPricingInfo>`: –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫—ç—à —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π.
*   `client.refreshModelPrices(): Promise<void>`: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à —Ü–µ–Ω –º–æ–¥–µ–ª–µ–π.

### ‚öôÔ∏è –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (`responseFormat`)

–ó–∞—Å—Ç–∞–≤—å—Ç–µ –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –≤ –≤–∏–¥–µ JSON.

*   `{ type: 'json_object' }`: –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON –æ–±—ä–µ–∫—Ç.
*   `{ type: 'json_schema', json_schema: { name: '...', schema: { ... } } }`: –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç JSON, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –≤–∞—à–µ–π —Å—Ö–µ–º–µ.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `responseFormat` –∏ `strictJsonParsing: false` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON –∏–ª–∏ JSON, –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ö–µ–º–µ, –ø–æ–ª–µ `content` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ `client.chat()` –±—É–¥–µ—Ç `null`. –ï—Å–ª–∏ `strictJsonParsing: true`, –±—É–¥–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω–∞ –æ—à–∏–±–∫–∞ `ValidationError`.

```typescript
// TypeScript Example
import OpenRouter from 'openrouter-kit';

async function getStructuredData() {
  const client = new OpenRouter({ apiKey: 'YOUR_KEY' });
  try {
    const userSchema = {
      type: "object",
      properties: { name: { type: "string"}, age: {type: "number"} },
      required: ["name", "age"]
    };
    const result = await client.chat({ // –ü–æ–ª—É—á–∞–µ–º ChatCompletionResult
      prompt: '–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ë–æ–±–∞ (–≤–æ–∑—Ä–∞—Å—Ç 42, bob@domain.com) —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–µ.',
      responseFormat: {
        type: 'json_schema',
        json_schema: { name: 'UserData', schema: userSchema }
      },
      // strictJsonParsing: true // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º JSON/—Å—Ö–µ–º–µ
    });

    if (result.content) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–µ content
      console.log('–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', result.content);
    } else {
      console.log('–ú–æ–¥–µ–ª—å –Ω–µ –≤–µ—Ä–Ω—É–ª–∞ –≤–∞–ª–∏–¥–Ω—ã–π JSON, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ö–µ–º–µ.');
    }
  } catch (error: any) {
    console.error('–û—à–∏–±–∫–∞:', error.message);
  } finally {
    await client.destroy();
  }
}

getStructuredData();
```

### ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–õ–æ–≤–∏—Ç–µ –æ—à–∏–±–∫–∏ —Å –ø–æ–º–æ—â—å—é `try...catch` –∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∏–ø –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `instanceof` –∏–ª–∏ –ø–æ–ª–µ `error.code` (—Å–º. `ErrorCode` enum).

```typescript
import { OpenRouterError, RateLimitError, ValidationError, ErrorCode } from 'openrouter-kit';

try {
  // ... –≤—ã–∑–æ–≤ client.chat() ...
} catch (error: any) {
  if (error instanceof RateLimitError) {
    const retryAfter = Math.ceil((error.details?.timeLeft || 0) / 1000);
    console.warn(`–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ ${retryAfter} —Å–µ–∫—É–Ω–¥.`);
  } else if (error.code === ErrorCode.VALIDATION_ERROR) {
    console.error(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: ${error.message}`, error.details);
  } else if (error.code === ErrorCode.TOOL_ERROR && error.message.includes('Maximum tool call depth')) {
     console.error(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: ${error.message}`);
  } else if (error instanceof OpenRouterError) { // –õ–æ–≤–∏–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    console.error(`–û—à–∏–±–∫–∞ OpenRouter Kit (${error.code}): ${error.message}`);
  } else {
    console.error(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: ${error.message}`);
  }
}
```

–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —Å–ª—É—à–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞:
`client.on('error', (error) => { /* ... */ });`

### üåê –ü—Ä–æ–∫—Å–∏

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∫—Å–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞:

```typescript
// TypeScript Example
import OpenRouter from 'openrouter-kit';

// –§–æ—Ä–º–∞—Ç URL —Å—Ç—Ä–æ–∫–∏
const client1 = new OpenRouter({
  apiKey: 'YOUR_KEY',
  proxy: 'http://user:pass@your-proxy.com:8080'
});

// –§–æ—Ä–º–∞—Ç –æ–±—ä–µ–∫—Ç–∞
const client2 = new OpenRouter({
  apiKey: 'YOUR_KEY',
  proxy: { host: 'proxy.example.com', port: 8888, user: 'usr', pass: 'pwd' }
});
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

[MIT](LICENSE)